var x=15/18,j='#111',F=15,q='Ver 1.0',C={},G=3;function i(){G--}function b(t,i){for(var r=Array(t),s=0;s<t;s++)r[s]=i(s);return r}C.t=new Image,C.t.src='/pictures/game/board.jpg',C.t.onload=i,C.i=new Image,C.i.src='/pictures/game/bg.jpg',C.i.onload=i,C.h=new Image,C.h.src='/pictures/game/piece.png',C.h.onload=i;var r=(new Date).getTime()%1003;function d(t,i){return(32767&(r=214013*r+2531011))%(i-t)+t}function l(){return 0}function D(){}const e=[100,100,400,400,1e3,1e3,2e3,4e3];function v(h,t,i){function r(t){for(var i=[0,0,0],r=0;r<t;r++)i[h[r]]++;return i}var s,n,o=[];function a(t,i,r){for(;1!=h[t];)t++;for(var s=0;s<o.length;s++)if(o[s][1]==i&&o[s][2]==t)return r>o[s][0]&&(o[s][0]=r),0;o.push([r,i,t])}for(n=0;n<=t-6;n++)0==n?s=r(6):(s[h[n-1]]--,s[h[n+5]]++),0==s[2]&&0!=s[1]&&0==h[n]&&0==h[n+5]&&a(n,s[1],2*s[1]-2);for(n=0;n<=t-5;n++)0==n?s=r(5):(s[h[n-1]]--,s[h[n+4]]++),0!=s[2]||s[1]<2||a(n,s[1],2*s[1]-3);for(n=0;n<o.length;n++)i[o[n][0]]++}function H(g){function u(t,i){for(var r=0;r<8;r++)t[r]=i[r]}function c(t,i){for(var r=0;r<8;r++)t[r]-=i[r],i[r]=0}function y(t,i){for(var r=0;r<8;r++)t[r]+=i[r]}this.reset=function(){this.t=b(g,function(){return b(g,l)}),this.o=0,this.u=b(4,function(t){return b(t<2?g:2*g-1,function(){return b(2,function(){return b(8,l)})})}),this.v=b(2,function(){return b(8,l)})},this.reset(),this.restore=function(t,i){var r;return i&&((r=[[0,Array(8),Array(8)],[0,Array(8),Array(8)],[0,Array(8),Array(8)],[0,Array(8),Array(8)]])[0][0]=t[0][0],r[1][0]=t[1][0],r[2][0]=t[2][0],r[3][0]=t[3][0],r[4]=this.o,u(r[0][1],this.u[0][r[0][0]][0]),u(r[0][2],this.u[0][r[0][0]][1]),u(r[1][1],this.u[1][r[1][0]][0]),u(r[1][2],this.u[1][r[1][0]][1]),u(r[2][1],this.u[2][r[2][0]][0]),u(r[2][2],this.u[2][r[2][0]][1]),u(r[3][1],this.u[3][r[3][0]][0]),u(r[3][2],this.u[3][r[3][0]][1])),this.o=t[4],c(this.v[0],this.u[0][t[0][0]][0]),c(this.v[1],this.u[0][t[0][0]][1]),c(this.v[0],this.u[1][t[1][0]][0]),c(this.v[1],this.u[1][t[1][0]][1]),c(this.v[0],this.u[2][t[2][0]][0]),c(this.v[1],this.u[2][t[2][0]][1]),c(this.v[0],this.u[3][t[3][0]][0]),c(this.v[1],this.u[3][t[3][0]][1]),u(this.u[0][t[0][0]][0],t[0][1]),u(this.u[0][t[0][0]][1],t[0][2]),u(this.u[1][t[1][0]][0],t[1][1]),u(this.u[1][t[1][0]][1],t[1][2]),u(this.u[2][t[2][0]][0],t[2][1]),u(this.u[2][t[2][0]][1],t[2][2]),u(this.u[3][t[3][0]][0],t[3][1]),u(this.u[3][t[3][0]][1],t[3][2]),y(this.v[0],this.u[0][t[0][0]][0]),y(this.v[1],this.u[0][t[0][0]][1]),y(this.v[0],this.u[1][t[1][0]][0]),y(this.v[1],this.u[1][t[1][0]][1]),y(this.v[0],this.u[2][t[2][0]][0]),y(this.v[1],this.u[2][t[2][0]][1]),y(this.v[0],this.u[3][t[3][0]][0]),y(this.v[1],this.u[3][t[3][0]][1]),r},this.update=function(t,i){var r=[[0,Array(8),Array(8)],[0,Array(8),Array(8)],[0,Array(8),Array(8)],[0,Array(8),Array(8)]];r[0][0]=i,r[1][0]=t,r[2][0]=t-i+g-1,r[3][0]=t+i,r[4]=this.o,u(r[0][1],this.u[0][r[0][0]][0]),u(r[0][2],this.u[0][r[0][0]][1]),u(r[1][1],this.u[1][r[1][0]][0]),u(r[1][2],this.u[1][r[1][0]][1]),u(r[2][1],this.u[2][r[2][0]][0]),u(r[2][2],this.u[2][r[2][0]][1]),u(r[3][1],this.u[3][r[3][0]][0]),u(r[3][2],this.u[3][r[3][0]][1]);for(var s,h,n,o=Array(2*g-1),a=Array(2*g-1),f=0;f<g;f++)h=this.t[f][i],o[f]=h,a[f]=2==h?1:1==h?2:0;for(c(this.v[0],this.u[0][i][0]),c(this.v[1],this.u[0][i][1]),v(o,g,this.u[0][i][0]),v(a,g,this.u[0][i][1]),y(this.v[0],this.u[0][i][0]),y(this.v[1],this.u[0][i][1]),f=0;f<g;f++)h=this.t[t][f],o[f]=h,a[f]=2==h?1:1==h?2:0;if(c(this.v[0],this.u[1][t][0]),c(this.v[1],this.u[1][t][1]),v(o,g,this.u[1][t][0]),v(a,g,this.u[1][t][1]),y(this.v[0],this.u[1][t][0]),y(this.v[1],this.u[1][t][1]),r[2][0]<g)for(n=r[2][0]+1,s=g-r[2][f=0]-1;f<n;f++,s++)h=this.t[f][s],o[f]=h,a[f]=2==h?1:1==h?2:0;else for(n=2*g-r[2][0]-1,f=r[2][0]-g+1,s=0;s<n;f++,s++)h=this.t[f][s],o[s]=h,a[s]=2==h?1:1==h?2:0;if(c(this.v[0],this.u[2][r[2][0]][0]),c(this.v[1],this.u[2][r[2][0]][1]),v(o,n,this.u[2][r[2][0]][0]),v(a,n,this.u[2][r[2][0]][1]),y(this.v[0],this.u[2][r[2][0]][0]),y(this.v[1],this.u[2][r[2][0]][1]),r[3][0]<g)for(n=r[3][0]+1,f=r[3][0],s=0;s<n;f--,s++)h=this.t[f][s],o[s]=h,a[s]=2==h?1:1==h?2:0;else for(n=2*g-r[3][0]-1,f=g-1,s=r[3][0]-g+1;s<g;f--,s++)h=this.t[f][s],o[g-f-1]=h,a[g-f-1]=2==h?1:1==h?2:0;return c(this.v[0],this.u[3][r[3][0]][0]),c(this.v[1],this.u[3][r[3][0]][1]),v(o,n,this.u[3][r[3][0]][0]),v(a,n,this.u[3][r[3][0]][1]),y(this.v[0],this.u[3][r[3][0]][0]),y(this.v[1],this.u[3][r[3][0]][1]),r},this.evaluate=function(t){for(var i,r=0,s=this.v,h=t-1,n=1==t?1:0,o=this.o=0;o<8;o++)r+=e[o]*(s[h][o]-s[n][o])-10*(o+1)*s[n][o];for(25e3<r?r=25e3:r<-25e3&&(r=-25e3),0<s[n][7]?(r-=2e5,this.o=1+n):0<s[h][7]?(r+=2e5,this.o=1+h):0<s[n][5]||0<s[n][6]?r-=1e5:0<s[h][6]?r+=1e5:1<s[h][5]?r+=9e4:0<s[h][5]&&0<s[h][4]?r+=8e4:0<s[n][4]?r-=7e4:1<s[h][4]&&(r+=6e4),o=0;o<2;o++)for(i=0;i<8;i++)if(0!=s[o][i])return r;return this.o=-1,r},this.points=function(t,i){for(var r,s=[],h=b(g,function(){return b(g,l)}),n=0;n<g;n++)for(y=0;y<g;y++)if(0!=this.t[y][n])for(var o,a,f,e=-2;e<=2;e++)for(o=-2;o<=2;o++)f=e+n,(a=o+y)<0||f<0||g<=a||g<=f||0==this.t[a][f]&&(h[a][f]=1);for(n=0;n<g;n++)for(y=0;y<g;y++)0!=h[y][n]&&(this.t[y][n]=t,r=this.update(y,n),s.push([this.evaluate(t),[y,n]]),r=this.restore(r,!0),s[s.length-1].push(r),this.t[y][n]=0);if(s.sort(function(t,i){return i[0]-t[0]}),s.length<=i)return s;for(var u=s[i-1][0],c=i-1,v=i-1,y=i-2;0<=y&&s[y][0]==u;y--)c=y;for(y=i;y<s.length&&s[y][0]==u;y++)v=y;for(y=0;y<i-c;y++){var A,M=d(c+y,v+1);c+y!=M&&(A=s[c+y],s[c+y]=s[M],s[M]=A)}return s.length=i,s},this.A=function(t,i,r,s,h,n){var o=1&r?1==t?2:1:t;if(r==i)return this.points(o,1)[0][0];for(var a,f,e,u=i-r+2,c=this.points(o,u=u<3?3:u),u=c.length,v=!1,y=0;y<u&&(f=c[y][1],this.t[f[0]][f[1]]=o,a=this.restore(c[y][2],!0),e=0!=this.o?(v=!0,-1==this.o?0:this.evaluate(t)):this.A(t,i,r+1,s,h),this.restore(a),this.t[f[0]][f[1]]=0,1&r?e<h&&(h=e):s<e&&(s=e,0==r&&(n[0]=f[0],n[1]=f[1])),!(h<=s))&&!v;y++);return 1&r?h:s},this.M=function(t,i){if(0==this.o){var r=[0,0];return this.A(t,2*i,0,-1e6,1e6,r),r}}}function loadGame(t){var i=document.getElementById(t),u=i.getContext('2d'),r=i.width,s=i.height,o={},a=[],f=Math.floor(r/s<x?r:s*x),e=Math.floor(f/x);o.l=Math.floor((r-f)/2),o.t=Math.floor((s-e)/2),o.r=o.l+f,o.b=o.t+e;var c=f-2*(t=(t=Math.floor(f/35))<5?5:t),s=Math.floor(1.8*(r=Math.floor((e-f)/6))),h=Math.floor(1.2*r),n=Math.floor(.9*r),v=[];function y(t,i,r){k.t[t][i]=r,k.update(t,i),k.evaluate(r),v.push([t,i,r]),I.F=void 0}function A(t,i,r,s){return{l:t,t:i,r:r+t,b:s+i}}function M(t,i,r){return a.push(r={rect:t,f:{k:i||function(t,i,r){u.fillStyle='#000',u.fillRect(0,0,i,r)},g:r||D}}),r}function l(t,i,o){return(t=M(t,function(t,i,r){u.fillStyle=t.color||j,u.font=h+'px consolas',m(u,{l:0,t:0,r:i,b:r},t.text,n,5)},function(t,i,r,s,h,n){1==i&&o(t)})).text=i,t}function b(t,i,s,h){return h=h||n,(t=M(t,function(t,i,r){u.fillStyle=t.color||j,u.font=h+'px consolas',m(u,{l:0,t:0,r:i,b:r},t.text,h,s)})).text=i,t}function g(t,i,r){return i>=t.l&&i<t.r&&r>=t.t&&r<t.b}function m(t,i,r,s,h){var n,o,a=t.measureText(r).width;switch(Math.floor(--h/3)){case 0:o=i.t+s;break;case 1:o=(i.b+i.t+s)/2;break;case 2:o=i.b;break;default:o=i.t}switch(h%3){case 0:n=i.l;break;case 1:n=(i.r+i.l-a)/2;break;case 2:n=i.r-a;break;default:n=i.l}t.fillText(r,Math.round(n),Math.round(o))}function p(t,i,r){for(var s,h=void 0,n=0;n<a.length;n++)g((s=a[n]).rect,i,r)?(s.p=!0,s.f.g(s,t,i-s.rect.l,r-s.rect.t,s.rect.r-s.rect.l,s.rect.b-s.rect.t),void 0!==h&&(h=s)):s.p&&(s.p=!1,s.f.g(s,2,void 0,void 0,s.rect.r-s.rect.l,s.rect.b-s.rect.t));return h}function w(){var t;if(!(0<G))for(u.drawImage(C.i,o.l,o.t,f,e),t=0;t<a.length;t++){var i=a[t],r=o.l+i.rect.l,s=o.t+i.rect.t;u.translate(r,s);var h=i.rect.r-i.rect.l,n=i.rect.b-i.rect.t;i.f.k(i,h,n),u.translate(-r,-s)}}var k=new H(F);i.addEventListener('click',function(t){var i=Math.round(t.offsetX),t=Math.round(t.offsetY);g(o,i,t)&&p(1,i-o.l,t-o.t)}),i.addEventListener('mousemove',function(t){var i=Math.round(t.offsetX),t=Math.round(t.offsetY);g(o,i,t)&&p(0,i-o.l,t-o.t)});var I=M(A(t,t+3*r,c,c),function(t,i,r){var s,h,n=c/300,o=c/F,a=o/2;function f(t,i,r,s){u.moveTo(t,i),u.lineTo(r,s)}function e(t,i,r){var s;0==t?(s=o/3,u.fillStyle='#0C8',u.fillRect(o*i+a-s/2,o*r+a-s/2,s,s)):1==t?(s=o/4,u.fillStyle='#F80',u.fillRect(o*i+a-s/2,o*r+a-s/2,s,s)):2==t&&(s=o/4,u.fillStyle='#F0F',u.fillRect(o*i+a-s/2,o*r+a-s/2,s,s))}for(n<1&&(n=1),u.drawImage(C.t,0,0,i,r),u.beginPath(),u.lineWidth=n.toString(),u.strokeStyle='#888',s=0;s<F;s++)f(a,o*s+a,c-a,o*s+a),f(o*s+a,a,o*s+a,c-a);for(u.stroke(),s=0;s<F;s++)for(h=0;h<F;h++)!function(t,i,r){var s,h=2*o/3;if(1==t)s=[0,0,64,64];else{if(2!=t)return;s=[64,0,64,64]}u.drawImage(C.h,s[0],s[1],s[2],s[3],o*i+a-h/2,o*r+a-h/2,h,h)}(k.t[s][h],s,h);t.I&&e(0,t.I[0],t.I[1]),t.j&&e(1,t.j[0],t.j[1]),t.F&&e(2,t.F[0],t.F[1])},function(t,i,r,s,h,n){0==i||1==i?(r=Math.floor(r*F/c),s=Math.floor(s*F/c),0==i?t.I&&t.I.x==r&&t.I.y==s||(t.I=[r,s],w()):0==k.o&&0==k.t[r][s]&&E(r,s)):2==i&&t.I&&(t.I=void 0,w())});b(i=A(t,t,f-2*t,3*r),'五子棋小游戏',5,s).color='#444';var V,z=b(i=A(t,e-t-r,f-2*t,r),'',4);function B(t,i){z.color=i||j,z.text=t}function E(n,o,t,i){function r(t){switch(t){case-1:return'平局(〃\'▽\'〃)';case 1:return'你赢了(￣▽￣)／';case 2:return'胜负已定(￣.￣)'}return''}y(n,o,1),w();var s='';(t=i?function(){for(var t=[],i=-1;i<=1;i++)for(var r=-1;r<=1;r++){var s=n+i,h=o+r;0<=s&&0<=h&&s<F&&h<F&&0==k.t[s][h]&&t.push([s,h])}if(0!=t.length)return t[d(0,t.length)]}():k.M(2,3))?(s='对方落子 '+t,y(t[0],t[1],2),I.j=t,0!=k.o&&(s=r(k.o))):s=r(k.o),B(s),w()}function J(){k.reset(),I.j=I.F=void 0;var t=Math.floor(F/2);E(t,t,0,!0)}b(i,q,6).color='#444',l(i=A(t,t+c+3*r,s=4*r,2*r),'重来',function(){J()}),l(i={l:i.l+s,t:i.t,r:i.r+s,b:i.b},'悔棋',function(){var t;!function(){if(!(v.length<=2)){for(var t=0;t<2;t++){var i=v.pop();k.t[i[0]][i[1]]=0,k.update(i[0],i[1])}k.evaluate(1)}}(),0<v.length?(t=v[v.length-1],I.j=t):I.j=void 0,I.F=void 0,B(''),w()}),l(i={l:i.l+s,t:i.t,r:i.r+s,b:i.b},'提示',function(){I.F=k.M(1,3),I.F||B('没有可行方案'),w()}),B(''),J(),0<G&&(V=setInterval(function(){G<=0&&(clearInterval(V),w())},100))}