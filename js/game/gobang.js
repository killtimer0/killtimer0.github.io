var x=15/18,j='#111',F=15,q='Ver 1.0',C={},G=3;function i(){G--}function b(t,i){for(var r=Array(t),s=0;s<t;s++)r[s]=i(s);return r}C.t=new Image,C.t.src='pictures/game/board.jpg',C.t.onload=i,C.i=new Image,C.i.src='pictures/game/bg.jpg',C.i.onload=i,C.h=new Image,C.h.src='pictures/game/piece.png',C.h.onload=i;var r=(new Date).getTime()%1003;function d(t,i){return(32767&(r=214013*r+2531011))%(i-t)+t}function l(){return 0}function D(){}const e=[100,100,400,400,1e3,1e3,2e3,4e3];function v(h,t,i){function r(t){for(var i=[0,0,0],r=0;r<t;r++)i[h[r]]++;return i}var s,n,o=[];function a(t,i,r){for(;1!=h[t];)t++;for(var s=0;s<o.length;s++)if(o[s][1]==i&&o[s][2]==t)return r>o[s][0]&&(o[s][0]=r),0;o.push([r,i,t])}for(n=0;n<=t-6;n++)0==n?s=r(6):(s[h[n-1]]--,s[h[n+5]]++),0==s[2]&&0!=s[1]&&0==h[n]&&0==h[n+5]&&a(n,s[1],2*s[1]-2);for(n=0;n<=t-5;n++)0==n?s=r(5):(s[h[n-1]]--,s[h[n+4]]++),0!=s[2]||s[1]<2||a(n,s[1],2*s[1]-3);for(n=0;n<o.length;n++)i[o[n][0]]++}function H(M){function f(t,i){for(var r=0;r<8;r++)t[r]=i[r]}function u(t,i){for(var r=0;r<8;r++)t[r]-=i[r],i[r]=0}function c(t,i){for(var r=0;r<8;r++)t[r]+=i[r]}this.reset=function(){this.t=b(M,function(){return b(M,l)}),this.o=0,this.u=b(4,function(t){return b(t<2?M:2*M-1,function(){return b(2,function(){return b(8,l)})})}),this.v=b(2,function(){return b(8,l)})},this.reset(),this.restore=function(t,i){var r;return i&&((r=[[0,Array(8),Array(8)],[0,Array(8),Array(8)],[0,Array(8),Array(8)],[0,Array(8),Array(8)]])[0][0]=t[0][0],r[1][0]=t[1][0],r[2][0]=t[2][0],r[3][0]=t[3][0],r[4]=this.o,f(r[0][1],this.u[0][r[0][0]][0]),f(r[0][2],this.u[0][r[0][0]][1]),f(r[1][1],this.u[1][r[1][0]][0]),f(r[1][2],this.u[1][r[1][0]][1]),f(r[2][1],this.u[2][r[2][0]][0]),f(r[2][2],this.u[2][r[2][0]][1]),f(r[3][1],this.u[3][r[3][0]][0]),f(r[3][2],this.u[3][r[3][0]][1])),this.o=t[4],u(this.v[0],this.u[0][t[0][0]][0]),u(this.v[1],this.u[0][t[0][0]][1]),u(this.v[0],this.u[1][t[1][0]][0]),u(this.v[1],this.u[1][t[1][0]][1]),u(this.v[0],this.u[2][t[2][0]][0]),u(this.v[1],this.u[2][t[2][0]][1]),u(this.v[0],this.u[3][t[3][0]][0]),u(this.v[1],this.u[3][t[3][0]][1]),f(this.u[0][t[0][0]][0],t[0][1]),f(this.u[0][t[0][0]][1],t[0][2]),f(this.u[1][t[1][0]][0],t[1][1]),f(this.u[1][t[1][0]][1],t[1][2]),f(this.u[2][t[2][0]][0],t[2][1]),f(this.u[2][t[2][0]][1],t[2][2]),f(this.u[3][t[3][0]][0],t[3][1]),f(this.u[3][t[3][0]][1],t[3][2]),c(this.v[0],this.u[0][t[0][0]][0]),c(this.v[1],this.u[0][t[0][0]][1]),c(this.v[0],this.u[1][t[1][0]][0]),c(this.v[1],this.u[1][t[1][0]][1]),c(this.v[0],this.u[2][t[2][0]][0]),c(this.v[1],this.u[2][t[2][0]][1]),c(this.v[0],this.u[3][t[3][0]][0]),c(this.v[1],this.u[3][t[3][0]][1]),r},this.update=function(t,i){var r=[[0,Array(8),Array(8)],[0,Array(8),Array(8)],[0,Array(8),Array(8)],[0,Array(8),Array(8)]];r[0][0]=i,r[1][0]=t,r[2][0]=t-i+M-1,r[3][0]=t+i,r[4]=this.o,f(r[0][1],this.u[0][r[0][0]][0]),f(r[0][2],this.u[0][r[0][0]][1]),f(r[1][1],this.u[1][r[1][0]][0]),f(r[1][2],this.u[1][r[1][0]][1]),f(r[2][1],this.u[2][r[2][0]][0]),f(r[2][2],this.u[2][r[2][0]][1]),f(r[3][1],this.u[3][r[3][0]][0]),f(r[3][2],this.u[3][r[3][0]][1]);for(var s,h,n,o=Array(2*M-1),a=Array(2*M-1),e=0;e<M;e++)h=this.t[e][i],o[e]=h,a[e]=2==h?1:1==h?2:0;for(u(this.v[0],this.u[0][i][0]),u(this.v[1],this.u[0][i][1]),v(o,M,this.u[0][i][0]),v(a,M,this.u[0][i][1]),c(this.v[0],this.u[0][i][0]),c(this.v[1],this.u[0][i][1]),e=0;e<M;e++)h=this.t[t][e],o[e]=h,a[e]=2==h?1:1==h?2:0;if(u(this.v[0],this.u[1][t][0]),u(this.v[1],this.u[1][t][1]),v(o,M,this.u[1][t][0]),v(a,M,this.u[1][t][1]),c(this.v[0],this.u[1][t][0]),c(this.v[1],this.u[1][t][1]),r[2][0]<M)for(n=r[2][0]+1,s=M-r[2][e=0]-1;e<n;e++,s++)h=this.t[e][s],o[e]=h,a[e]=2==h?1:1==h?2:0;else for(n=2*M-r[2][0]-1,e=r[2][0]-M+1,s=0;s<n;e++,s++)h=this.t[e][s],o[s]=h,a[s]=2==h?1:1==h?2:0;if(u(this.v[0],this.u[2][r[2][0]][0]),u(this.v[1],this.u[2][r[2][0]][1]),v(o,n,this.u[2][r[2][0]][0]),v(a,n,this.u[2][r[2][0]][1]),c(this.v[0],this.u[2][r[2][0]][0]),c(this.v[1],this.u[2][r[2][0]][1]),r[3][0]<M)for(n=r[3][0]+1,e=r[3][0],s=0;s<n;e--,s++)h=this.t[e][s],o[s]=h,a[s]=2==h?1:1==h?2:0;else for(n=2*M-r[3][0]-1,e=M-1,s=r[3][0]-M+1;s<M;e--,s++)h=this.t[e][s],o[M-e-1]=h,a[M-e-1]=2==h?1:1==h?2:0;return u(this.v[0],this.u[3][r[3][0]][0]),u(this.v[1],this.u[3][r[3][0]][1]),v(o,n,this.u[3][r[3][0]][0]),v(a,n,this.u[3][r[3][0]][1]),c(this.v[0],this.u[3][r[3][0]][0]),c(this.v[1],this.u[3][r[3][0]][1]),r},this.evaluate=function(t){for(var i,r=0,s=this.v,h=t-1,n=1==t?1:0,o=this.o=0;o<8;o++)r+=e[o]*(s[h][o]-s[n][o])-10*(o+1)*s[n][o];for(25e3<r?r=25e3:r<-25e3&&(r=-25e3),0<s[n][7]?(r-=2e5,this.o=n):0<s[h][7]?(r+=2e5,this.o=h):0<s[n][5]||0<s[n][6]?r-=1e5:0<s[h][6]?r+=1e5:1<s[h][5]?r+=9e4:0<s[h][5]&&0<s[h][4]?r+=8e4:0<s[n][4]?r-=7e4:1<s[h][4]&&(r+=6e4),o=0;o<2;o++)for(i=0;i<8;i++)if(0!=s[o][i])return r;return this.o=-1,r},this.points=function(t,i){for(var r,s=[],h=b(M,function(){return b(M,l)}),n=0;n<M;n++)for(m=0;m<M;m++)if(0!=this.t[m][n])for(var o,a,e,f=-2;f<=2;f++)for(o=-2;o<=2;o++)e=f+n,(a=o+m)<0||e<0||M<=a||M<=e||0==this.t[a][e]&&(h[a][e]=1);for(n=0;n<M;n++)for(m=0;m<M;m++)0!=h[m][n]&&(this.t[m][n]=t,r=this.update(m,n),s.push([this.evaluate(t),[m,n]]),r=this.restore(r,!0),s[s.length-1].push(r),this.t[m][n]=0);if(s.sort(function(t,i){return i[0]-t[0]}),s.length<=i)return s;for(var u=s[i-1][0],c=i-1,v=i-1,m=i-2;0<=m&&s[m][0]==u;m--)c=m;for(m=i;m<s.length&&s[m][0]==u;m++)v=m;for(m=0;m<i-c;m++){var y,A=d(c+m,v+1);c+m!=A&&(y=s[c+m],s[c+m]=s[A],s[A]=y)}return s.length=i,s},this.A=function(t,i,r,s,h,n){var o=1&r?1==t?2:1:t;if(r==i)return this.points(o,1)[0][0];for(var a,e,f,u=i-r+1,c=this.points(o,u=u<3?3:u),u=c.length,v=!1,d=0;d<u&&(e=c[d][1],this.t[e[0]][e[1]]=o,a=this.restore(c[d][2],!0),f=0!=this.o?(v=!0,-1==this.o?0:this.evaluate(t)):this.A(t,i,r+1,s,h),this.restore(a),this.t[e[0]][e[1]]=0,1&r?f<h&&(h=f):s<f&&(s=f,0==r&&(n[0]=e[0],n[1]=e[1])),!(h<=s))&&!v;d++);return 1&r?h:s},this.M=function(t,i){if(0==this.o){var r=[0,0];return this.A(t,2*i,0,-1e6,1e6,r),r}}}function loadGame(t){var i=document.getElementById(t),u=i.getContext('2d'),r=i.width,s=i.height,o={},a=[],e=Math.floor(r/s<x?r:s*x),f=Math.floor(e/x);o.l=Math.floor((r-e)/2),o.t=Math.floor((s-f)/2),o.r=o.l+e,o.b=o.t+f;var c=e-2*(t=(t=Math.floor(e/35))<5?5:t),s=Math.floor(1.8*(r=Math.floor((f-e)/6))),h=Math.floor(1.2*r),n=Math.floor(.9*r),v=[];function b(t,i,r){w.t[t][i]=r,w.update(t,i),w.evaluate(r),v.push([t,i,r]),boardItem.F=void 0}function m(t,i,r,s){return{l:t,t:i,r:r+t,b:s+i}}function y(t,i,r){return a.push(r={rect:t,f:{k:i||function(t,i,r){u.fillStyle='#000',u.fillRect(0,0,i,r)},g:r||D}}),r}function A(t,i,o){return(t=y(t,function(t,i,r){u.fillStyle=t.color||j,u.font=h+'px consolas',I(u,{l:0,t:0,r:i,b:r},t.text,n,5)},function(t,i,r,s,h,n){1==i&&o(t)})).text=i,t}function M(t,i,s,h){return h=h||n,(t=y(t,function(t,i,r){u.fillStyle=t.color||j,u.font=h+'px consolas',I(u,{l:0,t:0,r:i,b:r},t.text,h,s)})).text=i,t}function l(t,i,r){return i>=t.l&&i<t.r&&r>=t.t&&r<t.b}function I(t,i,r,s,h){var n,o,a=t.measureText(r).width;switch(Math.floor(--h/3)){case 0:o=i.t+s;break;case 1:o=(i.b+i.t+s)/2;break;case 2:o=i.b;break;default:o=i.t}switch(h%3){case 0:n=i.l;break;case 1:n=(i.r+i.l-a)/2;break;case 2:n=i.r-a;break;default:n=i.l}t.fillText(r,Math.round(n),Math.round(o))}function g(t,i,r){for(var s,h=void 0,n=0;n<a.length;n++)l((s=a[n]).rect,i,r)?(s.p=!0,s.f.g(s,t,i-s.rect.l,r-s.rect.t,s.rect.r-s.rect.l,s.rect.b-s.rect.t),void 0!==h&&(h=s)):s.p&&(s.p=!1,s.f.g(s,2,void 0,void 0,s.rect.r-s.rect.l,s.rect.b-s.rect.t));return h}function p(){var t;if(!(0<G))for(u.drawImage(C.i,o.l,o.t,e,f),t=0;t<a.length;t++){var i=a[t],r=o.l+i.rect.l,s=o.t+i.rect.t;u.translate(r,s);var h=i.rect.r-i.rect.l,n=i.rect.b-i.rect.t;i.f.k(i,h,n),u.translate(-r,-s)}}var w=new H(F);i.addEventListener('click',function(t){var i=Math.round(t.offsetX),t=Math.round(t.offsetY);l(o,i,t)&&g(1,i-o.l,t-o.t)}),i.addEventListener('mousemove',function(t){var i=Math.round(t.offsetX),t=Math.round(t.offsetY);l(o,i,t)&&g(0,i-o.l,t-o.t)}),boardItem=y(m(t,t+3*r,c,c),function(t,i,r){var s,h,n=c/300,o=c/F,a=o/2;function e(t,i,r,s){u.moveTo(t,i),u.lineTo(r,s)}function f(t,i,r){var s;0==t?(s=o/3,u.fillStyle='#0C8',u.fillRect(o*i+a-s/2,o*r+a-s/2,s,s)):1==t?(s=o/4,u.fillStyle='#F80',u.fillRect(o*i+a-s/2,o*r+a-s/2,s,s)):2==t&&(s=o/4,u.fillStyle='#F0F',u.fillRect(o*i+a-s/2,o*r+a-s/2,s,s))}for(n<1&&(n=1),u.drawImage(C.t,0,0,i,r),u.beginPath(),u.lineWidth=n.toString(),u.strokeStyle='#888',s=0;s<F;s++)e(a,o*s+a,c-a,o*s+a),e(o*s+a,a,o*s+a,c-a);for(u.stroke(),s=0;s<F;s++)for(h=0;h<F;h++)!function(t,i,r){var s,h=2*o/3;if(1==t)s=[0,0,64,64];else{if(2!=t)return;s=[64,0,64,64]}u.drawImage(C.h,s[0],s[1],s[2],s[3],o*i+a-h/2,o*r+a-h/2,h,h)}(w.t[s][h],s,h);t.I&&f(0,t.I[0],t.I[1]),t.j&&f(1,t.j[0],t.j[1]),t.F&&f(2,t.F[0],t.F[1])},function(t,i,r,s,h,n){0==i||1==i?(r=Math.floor(r*F/c),s=Math.floor(s*F/c),0==i?t.I&&t.I.x==r&&t.I.y==s||(t.I=[r,s],p()):0==w.o&&0==w.t[r][s]&&B(r,s)):2==i&&t.I&&(t.I=void 0,p())}),M(i=m(t,t,e-2*t,3*r),'五子棋小游戏',5,s).color='#444';var k,V=M(i=m(t,f-t-r,e-2*t,r),'',4);function z(t,i){V.color=i||j,V.text=t}function B(n,o,t,i){function r(t){switch(t){case-1:return'平局(〃\'▽\'〃)';case 1:return'你赢了(￣▽￣)／';case 2:return'胜负已定(￣.￣)'}return''}b(n,o,1),p();var s='';(t=i?function(){for(var t=[],i=-1;i<=1;i++)for(var r=-1;r<=1;r++){var s=n+i,h=o+r;0<=s&&0<=h&&s<F&&h<F&&0==w.t[s][h]&&t.push([s,h])}if(0!=t.length)return t[d(0,t.length)]}():w.M(2,3))?(s='对方落子 '+t,b(t[0],t[1],2),boardItem.j=t,0!=w.o&&(s=r(w.o))):s=r(w.o),z(s),p()}function E(){w.reset(),boardItem.j=boardItem.F=void 0;var t=Math.floor(F/2);B(t,t,0,!0)}M(i,q,6).color='#444',A(i=m(t,t+c+3*r,s=4*r,2*r),'重来',function(){E()}),A(i={l:i.l+s,t:i.t,r:i.r+s,b:i.b},'悔棋',function(){var t;!function(){if(!(v.length<=2)){for(var t=0;t<2;t++){var i=v.pop();w.t[i[0]][i[1]]=i[2],w.update(i[0],i[1]),w.t[i[0]][i[1]]=0}w.evaluate(1)}}(),0<v.length?(t=v[v.length-1],boardItem.j=t):boardItem.j=void 0,boardItem.F=void 0,p()}),A(i={l:i.l+s,t:i.t,r:i.r+s,b:i.b},'提示',function(){boardItem.F=w.M(1,3),boardItem.F||z('没有可行方案'),p()}),z(''),E(),0<G&&(k=setInterval(function(){G<=0&&(clearInterval(k),p())},100))}