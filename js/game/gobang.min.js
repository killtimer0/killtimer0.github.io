const hr='JS五子棋',rr='2.2.1',pr='<h3>2.2</h3>又双叒叕修复了 AI 的一个严重 bug<br>增加棋序数字等信息, 增加帮助页面<br>点击棋盘获取焦点后支持键盘操作<h3>2.1</h3>修复 AI 在必输局面下乱走的 bug<br>拖动落子逻辑修改<h3>2.0</h3>使用 WebWorker, 速度优化<br>重构代码, 修复了 AI 的一些严重 bug<br>布局优化, 解决 canvas 模糊的问题<br>可自定义先手和难度<br>移动端增加拖动落子',Fr=[{S:'这是一个用 JS 开发的五子棋小游戏, 目标是能方便地嵌入其他网页中并流畅运行, 所以程序并没有调用外部资源或第三方库.<br>游戏中使用了 WebWorker 进行密集型计算(也就是 AI 部分). 相比于 1.0, 由于这种方式另开一个线程, 因此界面流畅程度有了很大的提升, 效率也高了很多.<br>灵感来自于<a target="_blank" href="https://tieba.baidu.com/p/4218602810">贴吧</a>, 按着逻辑重写了一遍并加入了更多内容<br>游戏仍在开发中, 目前在考虑加入禁手规则<del>和万宁五子棋</del>'},{name:'操作相关',S:'<h4>鼠标</h4>点击落子, 右边可以自定义先手(下一局开始生效)和难度. 在移动端可以通过按住棋盘并滑动来调整落子位置.<h4>键盘</h4><table><col width="150"/><tr><td>WASD / 方向键</td><td>移动光标</td></tr><tr><td>空格 / 回车</td><td>落子</td></tr><tr><td>Q</td><td>悔棋</td></tr>'},{name:'反馈',S:'游戏过程中如果有碰到 bug 影响使用, 麻烦向作者反馈一份, 感谢!<img src="/pictures/bili-small-shrink/7/151.png" style="display: inline; width: 48px; height: 48px;"></img><br>QQ1837009039<br><a href="mailto: 1837009039@qq.com">发送邮件</a>'}],nr=['平局(〃\'▽\'〃)','你赢了(￣▽￣)／','胜负已定(￣.￣)'],gr=[,,'简单',,'一般',,'较难',,'大爷'],Qr={N:15,level:2,playerFirst:!0,boardSize:576,rWidth:180,godMode:!1,lineColor:'#000C',mptColor:'#0C8',moppColor:'#F80',mtipColor:'#F0F',scale:2};function T(r){return r+'px'}function U(r,n){for(var t=Array(r),a=0;a<r;a++)t[a]=n(a);return t}function X(){return 0}function Y(r,n,t,a){r.beginPath(),r.arc(n,t,a,0,2*Math.PI),r.fill(),r.stroke()}function Z(r,n){return r(),setInterval(r,n)}function _(n,t){return function(r){n(t)}}function yr(r){return document.createElement(r)}function Ar(r,n){r.appendChild(n)}const ar={o:0,t:1,u:2,i:3},or={reset:'重来',v:'退回',k:'提示',W:'棋序',info:'信息',q:'帮助'};if(!this.document){function p(r,n,t,a){for(var e=U(n,function(){return[0,0]}),o=0,f=4;f<n;f++){for(var c=0,i=!1,u=0,v=0;v<5;v++){switch(r[f-v]){case 1:s=f-v,c++,0==u&&(u=f-v);break;case 2:f+=4-v,i=!0}if(i)break}i||c<2||(5!=c?(l=2*c-2)>e[s][0]&&(e[s]=[l,u]):o++)}for(f=5;f<n;f++){var s,c=0,i=!1,u=0;if(0==r[f-5]&&0==r[f]){for(var l,v=0;v<6;v++){switch(r[f-v]){case 1:s=f-v,c++,0==u&&(u=f-v);break;case 2:f+=5-v,i=!0}if(i)break}i||0==c||2==c&&1<u-s||(l=2*c-1)>e[s][0]&&(e[s]=[l,u])}}for(f=0;f<8;f++)t[f]=0;for(var b=0,f=0;f<n;f++)0!=e[f][0]&&e[f][1]>b&&(t[e[f][0]-1]++,a[e[f][0]-1]++,b=e[f][1]);t[7]+=o,a[7]+=o}function a(r,n){for(var t=U(2,function(){return U(4,function(r){return U(r<2?n:2*n-9,function(){return U(8,X)})})}),a=U(2,function(){return U(8,X)}),e=Array(n),o=0;o<2;o++){var f=[0,2,2];f[o+1]=1;for(var c=0;c<n;c++){for(var i=0;i<n;i++)e[i]=f[r[c][i]];for(p(e,n,t[o][0][c],a[o]),i=0;i<n;i++)e[i]=f[r[i][c]];p(e,n,t[o][1][c],a[o])}for(c=0;c<2*n-9;c++){var u=n-5-c,v=0,s=c+5;for(u<0&&(v=-u,u=0,s=2*n-5-c),i=0;i<s;i++)e[i]=f[r[u+i][v+i]];for(p(e,s,t[o][2][c],a[o]),u=0,s=c+5,n<=(v=4+c)&&(u=v-n+1,v=n-1,s=2*n-5-c),i=0;i<s;i++)e[i]=f[r[u+i][v-i]];p(e,s,t[o][3][c],a[o])}}return[t,a]}function D(r,n,t,a,e,o,f){var c={},i=Array(n);function u(r){for(var n=Array(8),t=0;t<8;t++)n[t]=r[t];return n}function v(r,n){for(var t=0;t<8;t++)r[t]-=n[t]}c.l=[t,a],c.all=[u(f[0]),u(f[1])],r[a][t]=e,c[0]=[u(o[0][0][a]),u(o[1][0][a])],v(f[0],o[0][0][a]),v(f[1],o[1][0][a]);for(var s=0;s<2;s++){(m=[0,2,2])[s+1]=1;for(var l=0;l<n;l++)i[l]=m[r[a][l]];p(i,n,o[s][0][a],f[s])}for(c[1]=[u(o[0][1][t]),u(o[1][1][t])],v(f[0],o[0][1][t]),v(f[1],o[1][1][t]),s=0;s<2;s++){for((m=[0,2,2])[s+1]=1,l=0;l<n;l++)i[l]=m[r[l][t]];p(i,n,o[s][1][t],f[s])}var b=n+t-a-5;if(0<=b&&b<2*n-9){c[2]=[u(o[0][2][b]),u(o[1][2][b])],v(f[0],o[0][2][b]),v(f[1],o[1][2][b]);var h=0,d=b+5;for((k=n-5-b)<0&&(h=-k,k=0,d=2*n-5-b),s=0;s<2;s++){for((m=[0,2,2])[s+1]=1,l=0;l<d;l++)i[l]=m[r[k+l][h+l]];p(i,d,o[s][2][b],f[s])}}if(0<=(b=t+a-4)&&b<2*n-9){c[3]=[u(o[0][3][b]),u(o[1][3][b])],v(f[0],o[0][3][b]),v(f[1],o[1][3][b]);var k=0,d=b+5;n<=(h=4+b)&&(k=h-n+1,h=n-1,d=2*n-5-b);for(var m,s=0;s<2;s++){for((m=[0,2,2])[s+1]=1,l=0;l<d;l++)i[l]=m[r[k+l][h-l]];p(i,d,o[s][3][b],f[s])}}return c}this.addEventListener('message',function(r){var[n,a,e,r]=r.data;(e=t(n,a,r,e))?this.postMessage([!0,e]):this.postMessage([!1])});const h={D:0,M:1,g:2},k=[10,10,60,70,150,180,1e3,1200];function M(r,n){for(var t=n-1,n=2-n,a=[0,0],e=0;e<2;e++)for(var o=0;o<5;o++)a[e]+=r[e][o]*k[o];return 0==(n=a[t]-a[n])?h.D:0<n?h.M:h.g}function g(r,n,t){var a=n-1,e=2-n,o=0;0<r[e][7]?o=-5e5:0<r[a][7]?o=5e5:0<r[e][6]?o=-4e5:0<r[e][5]?o=-3e5:0<r[a][6]||1<r[a][5]?o=3e5:0<r[a][5]&&0<r[a][4]?o=2e5:0<r[e][4]?o=-1e5:1<r[a][4]&&(o=1e5);var n=0,f=0,c=0,i=[0,0];switch(t){case h.D:f=c=5;break;case h.M:f=6,c=4;break;case h.g:f=4,c=6}for(var u=0;u<2;u++)for(var v=0;v<8;v++)i[u]+=r[u][v]*k[v];return o+((n=1e5<=(n=i[a]*f-i[e]*c)?99999:n)<=-1e5?-99999:n)}function A(r,n,t,a,e){for(var o=0;o<2;o++)for(var f=0;f<8;f++)a[o][f]=e.all[o][f];var[c,i]=e.l;t[0][0][i]=e[0][0],t[1][0][i]=e[0][1],t[0][1][c]=e[1][0],t[1][1][c]=e[1][1];var u=n+c-i-5;0<=u&&u<2*n-9&&(t[0][2][u]=e[2][0],t[1][2][u]=e[2][1]),0<=(u=c+i-4)&&u<2*n-9&&(t[0][3][u]=e[3][0],t[1][3][u]=e[3][1]),r[i][c]=0}function I(r,n,t,a,e,o){for(var f,c=[],i=U(n,function(){return U(n,X)}),u=M(o,e),v=0;v<n;v++)for(var s=0;s<n;s++)if(0!=r[v][s]){var l=v-2,b=s-2,h=v+3,d=s+3;b<0&&(b=0),n<h&&(h=n),n<d&&(d=n);for(var k=l=l<0?0:l;k<h;k++)for(var p=b;p<d;p++)i[k][p]=1}for(v=0;v<n;v++)for(s=0;s<n;s++)0==r[v][s]&&0!=i[v][s]&&(f=D(r,n,s,v,t,e,o),mark=g(o,t,u),A(r,n,e,o,f),c.push([mark,[v,s]]));return c.sort(function(r,n){return n[0]-r[0]}),c.length<=a||(c.length=a),c}function t(k,p,m,r){const w=[16,12,10,9,8,7,6,5,5];var[$,n]=function(){for(var r,n=0,t=0;t<k;t++)for(var a=0;a<k;a++)0!=p[t][a]&&(n++,r=[a,t]);var e=Math.floor(k/2);if(0==n)return[[e,e]];if(1!=n)return[!1,n];if(r[0]==e&&r[1]==e)return 4<=(f=7<(f=Math.floor(8*Math.random()))?7:f)&&f++,f=(f-(o=f%3))/3,[[e+--o,e+--f]];var e=k/2,o=r[0]<e?1:r[0]>e?-1:0,f=r[1]<e?1:r[1]>e?-1:0;return[[r[1]+f,r[0]+o]]}();if($)return $;if(0==(m=(n=k*k-n)<m?n:m))return!1;var[M,C]=a(p,k);return function r(n,t,a,e){if(t==m)return g(C,3-n,h.D);for(var o=t<9?w[t]:4,f=I(p,k,n,o,M,C),o=f.length,c=3-n,i=t+1,u=(m-t)%2==0,v=0;v<o;v++){var s=f[v][1][1],l=f[v][1][0],b=D(p,k,s,l,n,M,C),d=0<C[n-1][7]?g(C,u?c:n,h.D)+5e5*(u?i-m:m-i):r(c,i,a,e);if(u?d<e&&(e=d,0==t&&($=[l,s])):a<d&&(a=d,0==t&&($=[l,s])),A(p,k,M,C,b),e<=a)break}return u?e:a}(r,0,-(n=1e6+5e5*m),n),$}}function loadGobangGame(r,n,t,a){var e=document.getElementById(r);if(!e)return console.warn(`No object names '${r}'`),!1;function o(r){return(a&&null!=a[r]?a:Qr)[r]}var f,c,v=o('N'),i=o('boardSize'),u=o('rWidth'),s=o('scale'),l=o('godmode'),b=o('lineColor'),h=o('mptColor'),d=o('moppColor'),k=o('mtipColor'),p=o('playerFirst'),m=o('level'),w=0,$=i*s,g=i/30,A=yr('canvas');A.width=A.height=$,A.style.width=A.style.height=T(i),A.style.margin=T(g);var M=A.getContext('2d');(W=yr('table')).style.width=T(u),W.style.height=T(i),W.style.padding=T(g),W.style.paddingBottom='0';var C=yr('span'),I=yr('table');function y(r,n){r.style.position='absolute',r.style.left=r.style.top=0,r.style.width=r.style.height='100%',r.style.padding=r.style.margin=0,r.style.zIndex=n}I.tabIndex=0,I.style.margin='auto',I.style.userSelect='none',I.style.position='relative',y(q=yr('div'),1e4),q.style.background='white',q.style.opacity=.7,q.hidden=!0,y(N=yr('div'),12e3),N.style.userSelect='text',N.hidden=!0,N.style.overflowY='auto',Ar(I,N),Ar(I,q);var D=!1,W=yr('td');function x(r,n,t){(t=yr(t||'p')).innerHTML=n,Ar(r,t)}var S,F,q,N,D,Q=yr('tr'),z=yr('td');function E(){c&&c.terminate(),(c=new Worker(n)).addEventListener('message',J)}function J(r){var n,r=r.data;ur&&f==ar.t?(n=r[1],clearInterval(B),r[0]?(mr(n[1],n[0]),fr=n,j()):kr('没有可行方案'),ur=!1):!ur&&f==ar.u&&r[0]&&(n=r[1],G((er=n)[1],n[0]))}function P(u){D||(function(r,n){var t=r.style.display;r.style.display='flex',r.style.flexDirection='column';var a=yr('div');a.style.padding=T(g),a.style.overflowY='auto',a.style.flexGrow=1;var e=yr('div');function o(){r.style.display=t,n()}e.style.padding=T(g),e.style.display='flex',e.style.justifyContent='flex-end';var f=[{name:'确定',P:o}];u(a,f,o);for(var c=0;c<f.length;c++){var i=yr('button');i.innerText=f[c].name,i.style.paddingLeft=i.style.paddingRight=i.style.marginLeft=T(g),i.addEventListener('click',f[c].P),Ar(e,i)}Ar(r,a),Ar(r,e)}(N,function(){N.innerHTML='',q.hidden=N.hidden=!0,D=!1}),q.hidden=N.hidden=!1,D=!0)}function j(){M.resetTransform(),M.clearRect(0,0,$,$);var r=$/v,n=r/2,t=r/40;M.beginPath(),M.lineWidth=t.toString(),M.strokeStyle=b;for(var a=0;a<v;a++)M.moveTo(n,r*(a+.5)),M.lineTo($-n,r*(a+.5)),M.moveTo(r*(a+.5),n),M.lineTo(r*(a+.5),$-n);M.stroke();var e=.4*r,o=M.createRadialGradient(.4*e,.4*-e,0,e/4,-e/4,.7*e);o.addColorStop(0,'#CCC'),o.addColorStop(1,'black');var f=M.createRadialGradient(.4*e,.4*-e,0,e/4,-e/4,.7*e);f.addColorStop(0,'white'),f.addColorStop(1,'#DDD');for(var c,i=0;i<cr.length;i++){var a=cr[i][1],u=cr[i][0];M.resetTransform(),M.translate(r*(a+.5),r*(u+.5)),i%2==0?(M.strokeStyle='black',M.fillStyle=o):(M.strokeStyle='#DDD',M.fillStyle=f),Y(M,0,0,e)}if(er&&(a=er[1],u=er[0],c=.16*r,M.fillStyle=d,M.resetTransform(),M.translate(r*(a+.5),r*(u+.5)),M.fillRect(-c,-c,2*c,2*c)),fr&&(a=fr[1],u=fr[0],c=.13*r,M.fillStyle=k,M.resetTransform(),M.translate(r*(a+.5),r*(u+.5)),M.fillRect(-c,-c,2*c,2*c)),tr&&(a=tr[1],u=tr[0],c=.1*r,M.fillStyle=h,M.resetTransform(),M.translate(r*(a+.5),r*(u+.5)),M.fillRect(-c,-c,2*c,2*c)),M.font=`${Math.round(2*r/5)}px Arial`,M.textAlign='center',M.textBaseline='middle',vr)for(i=0;i<cr.length;i++)a=cr[i][1],u=cr[i][0],M.resetTransform(),M.translate(r*(a+.5),r*(u+.5)),M.fillStyle=i%2==0?'white':'black',M.fillText(i+1,0,0)}Ar(z,A),Ar(Q,z),(z=yr('td')).style.width=T(u),z.style.height=T(i),(r=yr('table')).style.width=T(u),r.style.height=T(i),r.style.padding=T(g),r.style.paddingBottom='0',Ar(s=yr('tr'),W),Ar(r,s),(s=yr('tfoot')).style.textAlign='center',s.style.cursor='pointer',S=s,(F=yr('span')).style.color=b,F.style.fontSize=T(.7*g),F.innerText=`${hr} v${rr}`,Ar(S,F),s.addEventListener('click',function(r){P(function(r,n,t){x(r,hr,'h2'),x(r,'版本: '+rr+'<br>作者: KillTimer'),x(r,'更新内容','h2'),x(r,pr),n.unshift({name:'帮助',P:function(){t(),lr()}})})}),Ar(r,s),Ar(z,r),Ar(Q,z),Ar(I,Q),Q=yr('tr'),(z=yr('td')).rowSpan='2',Ar(z,C),Ar(Q,z),Ar(I,Q),Ar(e,I),function(){var n=u/2;function r(r){r.style.width=T(n),r.style.display='block',r.style.marginLeft=r.style.marginRight='auto',r.style.marginBottom=T(g),r.style.paddingTop=r.style.paddingBottom=T(3),r.style.textAlign='center'}var t,a=yr('select');a.style.appearance='none',(t=yr('option')).value=0,t.innerText='我先手',Ar(a,t),(t=yr('option')).value=1,t.innerText='我后手',Ar(a,t),a[f=p?0:1].selected=!0,r(a),a.addEventListener('change',function(r){p=0==a.value}),Ar(W,a);var e=yr('select');e.style.appearance='none';for(var o,f=0;f<gr.length;f++)gr[f]&&((t=yr('option')).value=f,t.innerText=gr[f],f==m&&(t.selected=!0),Ar(e,t));r(e),e.addEventListener('change',function(r){var n=parseInt(e.value);0<n&&(m=n)}),Ar(W,e);for(const c in or)r(o=yr('button')),o.innerText=or[c],o.addEventListener('click',_(zr,or[c])),Ar(W,o)}();var B,K=0;function L(){for(var r='计算机思考中',n=0;n<=K;n++)r+='.';kr(r),3<=++K&&(K=0)}function O(){for(var r='计算中',n=0;n<=K;n++)r+='.';kr(r),3<=++K&&(K=0)}function R(){if(f!=ar.o){for(var r=0,n=0;n<v;n++){for(var t=4;t<v;t++){for(var a=1;a<=2&&!(r=o(a,V[n][t],V[n][t-1],V[n][t-2],V[n][t-3],V[n][t-4])?a:r)&&!(r=o(a,V[t][n],V[t-1][n],V[t-2][n],V[t-3][n],V[t-4][n])?a:r);a++);if(r)break}if(r)break}for(n=4;n<v;n++){for(t=4;t<v;t++){for(a=1;a<=2&&!(r=o(a,V[n][t],V[n-1][t-1],V[n-2][t-2],V[n-3][t-3],V[n-4][t-4])?a:r)&&!(r=o(a,V[n-4][t],V[n-3][t-1],V[n-2][t-2],V[n-1][t-3],V[n][t-4])?a:r);a++);if(r)break}if(r)break}if(r)return f=ar.i,w=r,1;for(var e=0,n=0;n<v;n++)for(t=0;t<v;t++)0!=V[t][n]&&e++;return e==v*v&&(f=ar.i,w=0,1)}function o(r,n,t,a,e,o){return n==r&&t==r&&a==r&&e==r&&o==r&&r}}function G(r,n){switch(f){case ar.o:f=ir?ar.t:ar.u;var t=Math.floor(v/2);ir||(er=[t,t]),G(t,t);break;case ar.t:br(r,n,1),f=ar.u,R()?G():(ur&&(E(),clearInterval(B),ur=B=!1),c.postMessage([v,V,2,m]),B=Z(L,1e3)),j();break;case ar.u:br(r,n,2),f=ar.t,B&&(clearInterval(B),B=!1,K=0),mr(r,n),R()&&G(),j();break;case ar.i:kr(nr[w])}}function H(){var r=0;switch(fr=!1,f){case ar.t:r=2;break;case ar.u:E(),B&&(clearInterval(B),B=!1),f=ar.t,r=1;break;case ar.i:r=((ir?1:0)+cr.length)%2+1,f=ar.t}if(0!=r)if(cr.length>=r){for(;r--;){var n=cr.pop();V[n[0]][n[1]]=0}0<cr.length?(n=cr[cr.length-1],er=[n[0],n[1]],mr(n[1],n[0]),j()):(f=ar.o,er=!1,G())}else kr('已经是开局了')}var V,tr,er,fr,cr,ir,ur,vr=!1;const sr=[{name:'坐标式:',P:function(r){for(var n,t,a='',e=0;e<r.length;e++)n=r[e][1],t=r[e][0],0!=e&&(a+=' '),a+=String.fromCharCode(n+65)+(t+1);return a}},{name:'数组式:',P:function(r){for(var n,t='[',a=0;a<r.length;a++)0!=a&&(t+=', '),n=r[a][1],t+=`[${r[a][0]}, ${n}]`;return t+']'}},{name:'分组式:',P:function(r){for(var n,t,a='',e='',o=0;o<r.length;o++)n=r[o][1],t=r[o][0],o%2==0?(0!=o&&(a+=', '),a+=`[${t}, ${n}]`):(1!=o&&(e+=', '),e+=`[${t}, ${n}]`);return`[[${a}], [${e}]]`}}];function lr(){P(function(r){x(r,or.q,'h2'),x(r,Fr[0].S);for(var n=1;n<Fr.length;n++){var t=yr('h3');t.innerText=Fr[n].name,Ar(r,t),(t=yr('p')).style.wordBreak='break-word',t.innerHTML=Fr[n].S,Ar(r,t)}})}function br(r,n,t){V[n][r]=t,cr.push([n,r])}function dr(){E(),ur=!1,B&&(clearInterval(B),B=!1),f=ar.o,ir=p,V=U(v,function(){return U(v,X)}),tr=er=fr=!1,cr=[],G()}function kr(r){C.innerText=r}function mr(r,n){kr(`[${n}, ${r}]`)}function wr(r,n){return[r=(r=Math.floor(r/i*v))<0?0:v<=r?v-1:r,n=(n=Math.floor(n/i*v))<0?0:v<=n?v-1:n]}function $r(r,n){tr&&r==tr[1]&&n==tr[0]||(f!=ar.t||ur||mr(r,n),tr=[n,r],j())}function Mr(r,n){f==ar.t?0==V[n][r]||l?(fr=!1,G(r,n)):kr('该点已经有子'):f==ar.u&&kr('计算机正在思考')}'function'==typeof t&&t(I,A,W,C),dr(),A.addEventListener('mousemove',function(r){var[n,t]=wr(r.offsetX,r.offsetY);$r(n,t),r.preventDefault()}),A.addEventListener('click',function(r){var[n,r]=wr(r.offsetX,r.offsetY);Mr(n,r)});var Cr,Ir,Dr,Wr,xr,Sr=0,qr=i*i/(v*v);function Nr(r){var n=A.getBoundingClientRect();return[Math.round(r.clientX-n.x),Math.round(r.clientY-n.y)]}function zr(r){switch(r){case or.v:H();break;case or.reset:dr();break;case or.k:f!=ar.t||ur||(c.postMessage([v,V,1,m]),B=Z(O,1e3),ur=!0);break;case or.W:vr=!vr,j();break;case or.info:P(function(r){x(r,or.info,'h2'),x(r,`第 ${cr.length} 手`),x(r,`先手: ${ir?'玩家':'电脑'}`),x(r,`难度: ${gr[m]}(${m})`);var n,t=yr('fieldset'),a=yr('legend');for(n in t.style.marginBottom=T(g),a.innerHTML='<h3>棋局信息</h3>',Ar(t,a),sr){var e=sr[n];x(t,e.name,'h4');var o=yr('p');o.style.maxHeight=T(i/3),o.style.overflowY='auto',o.style.wordBreak='break-word',o.innerText=e.P(cr),Ar(t,o)}Ar(r,t)});break;case or.q:lr()}}A.addEventListener('touchstart',function(r){var n;1==r.touches.length&&([Cr,Ir]=Nr(r.touches[0]),Sr=0,[n,r]=wr(Cr,Ir),$r(n,r),xr=!0)}),A.addEventListener('touchmove',function(r){var n,t,a,e;1==r.touches.length&&xr?([n,t]=Nr(r.touches[0]),0==Sr?3*qr<=(a=n-Cr)*a+(e=t-Ir)*e&&(Sr=1,Dr=Math.round(3*Math.sqrt(20*qr)/5),Wr=Math.round(4*Math.sqrt(20*qr)/5)):(a=n-Dr,e=t-Wr,n<0||t<0||i<=a||i<=e?(tr=!1,j()):([a,e]=wr(a,e),$r(a,e))),r.preventDefault()):xr=!1}),A.addEventListener('touchend',function(r){tr&&Mr(tr[1],tr[0]),r.preventDefault()}),I.addEventListener('keydown',function(r){if(tr&&!D&&!r.ctrlKey&&!r.altKey&&!r.shiftKey&&!r.metaKey){var n,t,a,e=!0;switch(r.key){case'ArrowLeft':case'a':n=[0,-1];break;case'ArrowRight':case'd':n=[0,1];break;case'ArrowUp':case'w':n=[-1,0];break;case'ArrowDown':case's':n=[1,0];break;case'Enter':case' ':Mr(tr[1],tr[0]);break;case'q':H();break;default:e=!1}n&&([t,a]=tr,t+=n[0],a+=n[1],tr=[t=t<0?0:v<=t?v-1:t,a=a<0?0:v<=a?v-1:a],f!=ar.t||ur||mr(a,t),j()),e&&r.preventDefault()}})}