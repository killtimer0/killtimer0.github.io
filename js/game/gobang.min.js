const K=2,L='#8888',Q='#0C8',R='#F80',S='#F0F';function T(r){return r+'px'}function U(r,n){for(var t=Array(r),o=0;o<r;o++)t[o]=n(o);return t}function X(){return 0}function Y(r,n,t,o){r.beginPath(),r.arc(n,t,o,0,2*Math.PI),r.fill(),r.stroke()}function Z(r,n){return r(),setInterval(r,n)}function _(n,t){return function(r){n(t)}}const hr='JS五子棋',rr='2.0',pr='使用 WebWorker, 速度优化\n重构代码, 修复了 AI 的一些严重 bug\n布局优化, 解决 canvas 模糊的问题\n可自定义先手和难度\n移动端增加拖动落子',nr=['平局(〃\'▽\'〃)','你赢了(￣▽￣)／','胜负已定(￣.￣)'],gr=[,,'简单',,'一般',,'较难',,'缓慢'],ar={o:0,t:1,u:2,i:3},or={reset:'重来',v:'退回',k:'提示'};if(!this.document){function p(r,n,t,o){for(var e=U(n,function(){return[0,0]}),a=4;a<n;a++){for(var c=0,f=!1,u=0,i=0;i<5;i++){switch(r[a-i]){case 1:v=a-i,c++,0==u&&(u=a-i);break;case 2:a+=4-i,f=!0}if(f)break}f||c<2||(s=2*c-2)>e[v][0]&&(e[v]=[s,u])}for(a=5;a<n;a++){var v,c=0,f=!1,u=0;if(0==r[a-5]&&0==r[a]){for(var s,i=0;i<6;i++){switch(r[a-i]){case 1:v=a-i,c++,0==u&&(u=a-i);break;case 2:a+=5-i,f=!0}if(f)break}f||0==c||2==c&&1<u-v||(s=2*c-1)>e[v][0]&&(e[v]=[s,u])}}for(a=0;a<8;a++)t[a]=0;for(var d=0,a=0;a<n;a++)0!=e[a][0]&&e[a][1]>d&&(t[e[a][0]-1]++,o[e[a][0]-1]++,d=e[a][1])}function a(r,n){for(var t=U(2,function(){return U(4,function(r){return U(r<2?n:2*n-9,function(){return U(8,X)})})}),o=U(2,function(){return U(8,X)}),e=Array(n),a=0;a<2;a++){var c=[0,2,2];c[a+1]=1;for(var f=0;f<n;f++){for(var u=0;u<n;u++)e[u]=c[r[f][u]];for(p(e,n,t[a][0][f],o[a]),u=0;u<n;u++)e[u]=c[r[u][f]];p(e,n,t[a][1][f],o[a])}for(f=0;f<2*n-9;f++){var i=n-5-f,v=0,s=f+5;for(i<0&&(v=-i,i=0,s=2*n-5-f),u=0;u<s;u++)e[u]=c[r[i+u][v+u]];for(p(e,s,t[a][2][f],o[a]),i=0,s=f+5,n<=(v=4+f)&&(i=v-n+1,v=n-1,s=2*n-5-f),u=0;u<s;u++)e[u]=c[r[i+u][v-u]];p(e,s,t[a][3][f],o[a])}}return[t,o]}function D(r,n,t,o,e,a,c){var f={},u=Array(n);function i(r){for(var n=Array(8),t=0;t<8;t++)n[t]=r[t];return n}function v(r,n){for(var t=0;t<8;t++)r[t]-=n[t]}f.l=[t,o],f.all=[i(c[0]),i(c[1])],r[o][t]=e,f[0]=[i(a[0][0][o]),i(a[1][0][o])],v(c[0],a[0][0][o]),v(c[1],a[1][0][o]);for(var s=0;s<2;s++){(h=[0,2,2])[s+1]=1;for(var d=0;d<n;d++)u[d]=h[r[o][d]];p(u,n,a[s][0][o],c[s])}for(f[1]=[i(a[0][1][t]),i(a[1][1][t])],v(c[0],a[0][1][t]),v(c[1],a[1][1][t]),s=0;s<2;s++){for((h=[0,2,2])[s+1]=1,d=0;d<n;d++)u[d]=h[r[d][t]];p(u,n,a[s][1][t],c[s])}var m=n+t-o-5;if(0<=m&&m<2*n-9){f[2]=[i(a[0][2][m]),i(a[1][2][m])],v(c[0],a[0][2][m]),v(c[1],a[1][2][m]);var k=0,l=m+5;for((b=n-5-m)<0&&(k=-b,b=0,l=2*n-5-m),s=0;s<2;s++){for((h=[0,2,2])[s+1]=1,d=0;d<l;d++)u[d]=h[r[b+d][k+d]];p(u,l,a[s][2][m],c[s])}}if(0<=(m=t+o-4)&&m<2*n-9){f[3]=[i(a[0][3][m]),i(a[1][3][m])],v(c[0],a[0][3][m]),v(c[1],a[1][3][m]);var b=0,l=m+5;n<=(k=4+m)&&(b=k-n+1,k=n-1,l=2*n-5-m);for(var h,s=0;s<2;s++){for((h=[0,2,2])[s+1]=1,d=0;d<l;d++)u[d]=h[r[b+d][k-d]];p(u,l,a[s][3][m],c[s])}}return f}this.addEventListener('message',function(r){var[n,o,e,r]=r.data;(e=t(n,o,r,e))?this.postMessage([!0,e]):this.postMessage([!1])});const l={D:0,M:1,g:2},m=[10,10,60,70,150,180,1e3,1200];function M(r,n){for(var t=n-1,n=2-n,o=U(2,X),e=0;e<2;e++)for(var a=0;a<5;a++)o[e]+=r[e][a]*m[a];return 0==(n=o[t]-o[n])?l.D:0<n?l.M:l.g}function g(r,n,t){var o=n-1,e=2-n,a=0;0<r[e][7]?a=-4e5:0<r[o][7]?a=4e5:0<r[e][6]||0<r[e][5]?a=-3e5:0<r[o][6]||1<r[o][5]?a=3e5:0<r[o][5]&&0<r[o][4]?a=2e5:0<r[e][4]?a=-1e5:1<r[o][4]&&(a=1e5);var n=0,c=0,f=0,u=U(2,X);switch(t){case l.D:c=f=4;break;case l.M:c=5,f=3;break;case l.g:c=3,f=5}for(var i=0;i<2;i++)for(var v=0;v<8;v++)u[i]+=r[i][v]*m[v];return a+((n=1e5<=(n=u[o]*c-u[e]*f)?99999:n)<=-1e5?-99999:n)}function A(r,n,t,o,e){for(var a=0;a<2;a++)for(var c=0;c<8;c++)o[a][c]=e.all[a][c];var[f,u]=e.l;t[0][0][u]=e[0][0],t[1][0][u]=e[0][1],t[0][1][f]=e[1][0],t[1][1][f]=e[1][1];var i=n+f-u-5;0<=i&&i<2*n-9&&(t[0][2][i]=e[2][0],t[1][2][i]=e[2][1]),0<=(i=f+u-4)&&i<2*n-9&&(t[0][3][i]=e[3][0],t[1][3][i]=e[3][1]),r[u][f]=0}function I(r,n,t,o,e,a){for(var c,f=[],u=U(n,function(){return U(n,X)}),i=M(a,e),v=0;v<n;v++)for(var s=0;s<n;s++)if(0!=r[v][s]){var d=v-2,m=s-2,k=v+3,l=s+3;m<0&&(m=0),n<k&&(k=n),n<l&&(l=n);for(var b=d=d<0?0:d;b<k;b++)for(var h=m;h<l;h++)u[b][h]=1}for(v=0;v<n;v++)for(s=0;s<n;s++)0==r[v][s]&&0!=u[v][s]&&(c=D(r,n,s,v,t,e,a),mark=g(a,t,i),A(r,n,e,a,c),f.push([mark,[v,s]]));return f.sort(function(r,n){return n[0]-r[0]}),f.length<=o||(f.length=o),f}function t(l,b,h,p){const w=[12,10,10,8,8,6,6];var[y,r]=function(){for(var r,n=0,t=0;t<l;t++)for(var o=0;o<l;o++)0!=b[t][o]&&(n++,r=[o,t]);var e=Math.floor(l/2);if(0==n)return[[e,e]];if(1!=n)return[void 0,n];if(r[0]==e&&r[1]==e)return 4<=(c=7<(c=Math.floor(8*Math.random()))?7:c)&&c++,c=(c-(a=c%3))/3,[[e+--a,e+--c]];var e=l/2,a=r[0]<e?1:r[0]>e?-1:0,c=r[1]<e?1:r[1]>e?-1:0;return[[r[1]+c,r[0]+a]]}();if(y)return y;if(0!=(h=(r=l*l-r)<h?r:h)){var[C,F]=a(b,l);return function r(n,t,o,e){if(t==h)return g(F,p,M(F,p));for(var a=t<7?w[t]:4,c=I(b,l,n,a,C,F),a=c.length,f=3-n,u=t+1,i=t%2==0,v=0;v<a;v++){var s=c[v][1][1],d=c[v][1][0],m=D(b,l,s,d,n,C,F),k=0<F[n-1][7]?g(F,p,M(F,p))+4e5*(n==p?h-t:t-h):r(f,u,o,e);if(i?o<k&&(o=k,0==t&&(y=[d,s])):k<e&&(e=k,0==t&&(y=[d,s])),A(b,l,C,F,m),e<=o)break}return i?o:e}(p,0,-(r=1e6+4e5*h),r),y}}}function loadGobangGame(r,i,a,u,n,t){var o=document.getElementById(r);if(!o)return console.warn(`No object names '${r}'`),!1;var c,e,f=0,v=a*K,s=u/10,d=document.createElement('canvas');d.width=d.height=v,d.style.width=d.style.height=T(a),d.style.margin=T(s);var m=d.getContext('2d');(h=document.createElement('table')).style.width=T(u),h.style.height=T(a),h.style.padding=T(s),h.style.paddingBottom='0';var k=document.createElement('span');k.innerText='123';var l,b=document.createElement('table');b.style.margin='auto',b.style.userSelect='none',b.style.position='relative',(I=document.createElement('div')).style.position='absolute',I.style.left=I.style.top=0,I.style.width=I.style.height='100%',I.style.background='white',I.style.opacity=.7,I.style.userSelect='text',I.style.padding=0,I.hidden=!0,(l=document.createElement('div')).style.padding=T(s),I.appendChild(l),function(){function r(r,n){(n=document.createElement(n||'p')).innerText=r,l.appendChild(n)}r(hr,'h2'),r('版本: '+rr+'\n作者: KillTimer'),r('更新内容','h2'),r(pr);var n=document.createElement('button');n.innerText='确定',n.style.paddingLeft=n.style.paddingRight=T(s),n.addEventListener('click',function(){I.hidden=!0}),l.appendChild(n)}(),b.appendChild(I);var h=document.createElement('td'),p=document.createElement('tr'),w=document.createElement('td');w.appendChild(d),p.appendChild(w),(w=document.createElement('td')).style.width=T(u),w.style.height=T(a);var M,y,I,g=document.createElement('table');function D(){e&&e.terminate(),(e=new Worker(n)).addEventListener('message',A)}function A(r){var n,r=r.data;N&&c==ar.t?(n=r[1],clearInterval($),r[0]?(cr(n[1],n[0]),B=n,C()):er('没有可行方案'),N=!1):!N&&c==ar.u&&r[0]&&(n=r[1],G((j=n)[1],n[0]))}function C(){m.resetTransform(),m.clearRect(0,0,v,v);var r=v/i,n=r/2,t=r/40;m.beginPath(),m.lineWidth=t.toString(),m.strokeStyle=L;for(var o=0;o<i;o++)m.moveTo(n,r*(o+.5)),m.lineTo(v-n,r*(o+.5)),m.moveTo(r*(o+.5),n),m.lineTo(r*(o+.5),v-n);m.stroke();var e=.4*r,a=m.createRadialGradient(.4*e,.4*-e,0,e/4,-e/4,.7*e);a.addColorStop(0,'#CCC'),a.addColorStop(1,'black');var c=m.createRadialGradient(.4*e,.4*-e,0,e/4,-e/4,.7*e);c.addColorStop(0,'white'),c.addColorStop(1,'#DDD');for(var f,o=0;o<i;o++)for(var u=0;u<i;u++)1==x[u][o]?(m.strokeStyle='black',m.fillStyle=a,m.resetTransform(),m.translate(r*(o+.5),r*(u+.5)),Y(m,0,0,e)):2==x[u][o]&&(m.strokeStyle='#DDD',m.fillStyle=c,m.resetTransform(),m.translate(r*(o+.5),r*(u+.5)),Y(m,0,0,e));j&&(o=j[1],u=j[0],f=.16*r,m.fillStyle=R,m.resetTransform(),m.translate(r*(o+.5),r*(u+.5)),m.fillRect(-f,-f,2*f,2*f)),B&&(o=B[1],u=B[0],f=.13*r,m.fillStyle=S,m.resetTransform(),m.translate(r*(o+.5),r*(u+.5)),m.fillRect(-f,-f,2*f,2*f)),P&&(o=P[1],u=P[0],f=.1*r,m.fillStyle=Q,m.resetTransform(),m.translate(r*(o+.5),r*(u+.5)),m.fillRect(-f,-f,2*f,2*f))}g.style.width=T(u),g.style.height=T(a),g.style.padding=T(s),g.style.paddingBottom='0',(r=document.createElement('tr')).appendChild(h),g.appendChild(r),(r=document.createElement('tfoot')).style.textAlign='center',r.style.cursor='pointer',M=r,(y=document.createElement('span')).style.color='darkslategrey',y.style.fontSize=T(.8*s),y.innerText=hr,M.appendChild(y),(y=document.createElement('span')).style.color='darkslategrey',y.style.fontSize=T(.7*s),y.innerText=' Ver '+rr,M.appendChild(y),r.addEventListener('click',function(r){I.hidden=!1}),g.appendChild(r),w.appendChild(g),p.appendChild(w),b.appendChild(p),p=document.createElement('tr'),(w=document.createElement('td')).rowSpan='2',w.appendChild(k),p.appendChild(w),b.appendChild(p),o.appendChild(b);var F=!0,W=4;!function(){var n=u/2;function r(r){r.style.width=T(n),r.style.display='block',r.style.marginLeft=r.style.marginRight='auto',r.style.marginBottom=T(s),r.style.textAlign='center'}var t,o,e=document.createElement('select');(t=document.createElement('option')).value=0,t.innerText='我先手',e.appendChild(t),(t=document.createElement('option')).value=1,t.innerText='我后手',e.appendChild(t),e[c=F?0:1].selected=!0,r(e),e.addEventListener('change',function(r){F=0==e.value}),h.appendChild(e);for(const f in or)r(o=document.createElement('button')),o.innerText=or[f],o.addEventListener('click',_(wr,or[f])),h.appendChild(o);for(var a=document.createElement('select'),c=0;c<gr.length;c++)gr[c]&&((t=document.createElement('option')).value=c,t.innerText=gr[c],c==W&&(t.selected=!0),a.appendChild(t));r(a),a.addEventListener('change',function(r){var n=parseInt(a.value);0<n&&(W=n)}),h.appendChild(a)}();var $,x,P,j,B,E,J,N,O=0;function V(){for(var r='计算机思考中',n=0;n<=O;n++)r+='.';er(r),3<=++O&&(O=0)}function q(){for(var r='计算中',n=0;n<=O;n++)r+='.';er(r),3<=++O&&(O=0)}function z(){if(c!=ar.o){for(var r=0,n=0;n<i;n++){for(var t=4;t<i;t++){for(var o=1;o<=2&&!(r=a(o,x[n][t],x[n][t-1],x[n][t-2],x[n][t-3],x[n][t-4])?o:r)&&!(r=a(o,x[t][n],x[t-1][n],x[t-2][n],x[t-3][n],x[t-4][n])?o:r);o++);if(r)break}if(r)break}for(n=4;n<i;n++){for(t=4;t<i;t++){for(o=1;o<=2&&!(r=a(o,x[n][t],x[n-1][t-1],x[n-2][t-2],x[n-3][t-3],x[n-4][t-4])?o:r)&&!(r=a(o,x[n-4][t],x[n-3][t-1],x[n-2][t-2],x[n-1][t-3],x[n][t-4])?o:r);o++);if(r)break}if(r)break}if(r)return c=ar.i,f=r,1;for(var e=0,n=0;n<i;n++)for(t=0;t<i;t++)0!=x[t][n]&&e++;return e==i*i&&(c=ar.i,f=0,1)}function a(r,n,t,o,e,a){return n==r&&t==r&&o==r&&e==r&&a==r&&r}}function G(r,n){switch(c){case ar.o:c=J?ar.t:ar.u;var t=Math.floor(i/2);J||(j=[t,t]),G(t,t);break;case ar.t:H(r,n,1),c=ar.u,z()?G():(N&&(D(),clearInterval($),$=void 0,N=!1),e.postMessage([i,x,2,W]),$=Z(V,1e3)),C();break;case ar.u:H(r,n,2),c=ar.t,$&&(clearInterval($),$=void 0,O=0),cr(r,n),z()&&G(),C();break;case ar.i:er(nr[f])}}function H(r,n,t){x[n][r]=t,E.push([n,r])}function tr(){D(),N=!1,$&&(clearInterval($),$=void 0),c=ar.o,J=F,x=U(i,function(){return U(i,X)}),P=j=B=void 0,E=[],G()}function er(r){k.innerText=r}function cr(r,n){er(`[${n}, ${r}]`)}function fr(r,n){return[r=(r=Math.floor(r/a*i))<0?0:i<=r?i-1:r,n=(n=Math.floor(n/a*i))<0?0:i<=n?i-1:n]}function ur(r,n){P&&r==P[1]&&n==P[0]||(c!=ar.t||N||cr(r,n),P=[n,r],C())}function ir(r,n){c==ar.t?0!=x[n][r]?er('该点已经有子'):(B=void 0,G(r,n)):c==ar.u&&er('计算机正在思考')}'function'==typeof t&&t(b,d,h,k),tr(),d.addEventListener('mousemove',function(r){var[n,t]=fr(r.offsetX,r.offsetY);ur(n,t),r.preventDefault()}),d.addEventListener('click',function(r){var[n,r]=fr(r.offsetX,r.offsetY);ir(n,r)});var vr,sr,dr,mr,kr=0,lr=a*a*20/(i*i);function br(r){var n=d.getBoundingClientRect();return[Math.round(r.clientX-n.x),Math.round(r.clientY-n.y)]}function wr(r){switch(r){case or.v:!function(){var r=0;switch(B=void 0,c){case ar.t:r=2;break;case ar.u:D(),$&&(clearInterval($),$=void 0),c=ar.t,r=1;break;case ar.i:r=((J?1:0)+E.length)%2+1,c=ar.t}if(0!=r)if(E.length>=r){for(;r--;){var n=E.pop();x[n[0]][n[1]]=0}0<E.length?(n=E[E.length-1],j=[n[0],n[1]],cr(n[1],n[0]),C()):(c=ar.o,j=void 0,G())}else er('已经是开局了')}();break;case or.reset:tr();break;case or.k:c!=ar.t||N||(e.postMessage([i,x,1,W]),$=Z(q,1e3),N=!0)}}d.addEventListener('touchstart',function(r){var n,t;1==r.touches.length&&([vr,sr]=br(r.touches[0]),kr=0,[n,t]=fr(vr,sr),ur(n,t),r.preventDefault())}),d.addEventListener('touchmove',function(r){var n,t,o,e;1==r.touches.length&&([o,e]=br(r.touches[0]),0==kr?lr<=(n=o-vr)*n+(t=e-sr)*t&&(kr=1,dr=n,mr=t):(e-=mr,(o-=dr)<0||e<0||a<=o||a<=e?(P=void 0,C()):([o,e]=fr(o,e),ur(o,e))),r.preventDefault())}),d.addEventListener('touchend',function(r){P&&ir(P[1],P[0]),r.preventDefault()})}