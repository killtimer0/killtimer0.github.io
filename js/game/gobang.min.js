const Ar='JS五子棋',xr='2.2.3',Mr='GobangConfig',Cr=[['2.2','.0 又双叒叕修复了 AI 的一个严重 bug','.1 增加棋序数字等信息, 增加帮助页面','.1 点击棋盘获取焦点后支持键盘操作','.2 支持使用 storage 保存用户设置','.3 布局由table布局修改为flex布局','.3 增加棋盘存储, 刷新后仍保留棋盘现场'],['2.1','.0 修复 AI 在必输局面下乱走的 bug','.0 拖动落子逻辑修改'],['2.0','使用 WebWorker, 速度优化','重构代码, 修复了 AI 的一些严重 bug','布局优化, 解决 canvas 模糊的问题','可自定义先手和难度','移动端增加拖动落子']],Ir=[{t:'这是一个用 JS 开发的五子棋小游戏, 目标是能方便地嵌入其他网页中并流畅运行, 所以程序并没有调用外部资源或第三方库, 直接 JS 动态创建元素.<br>游戏中使用了 WebWorker 进行密集型计算(也就是 AI 部分). 相比于 1.0, 由于这种方式另开一个线程, 因此界面流畅程度有了很大的提升, 效率也高了很多.<br>灵感来自于<a target="_blank" href="https://tieba.baidu.com/p/4218602810">贴吧</a>, 按着逻辑重写了一遍并加入了更多内容<br>游戏仍在开发中, 目前在考虑加入禁手规则<del>和万宁阵法<img src="/pictures/bili-small-shrink/1/2373.png" style="display: inline; width: 48px; height: 48px;" /></del>'},{name:'操作相关',t:'<h4>鼠标</h4>点击落子, 右边可以自定义先手(下一局开始生效)和难度. 在移动端可以通过按住棋盘并滑动来调整落子位置.<h4>键盘</h4><table><col width="150"/><tr><td>WASD / 方向键</td><td>移动光标</td></tr><tr><td>空格 / 回车</td><td>落子</td></tr><tr><td>Q</td><td>悔棋</td></tr>'},{name:'反馈',t:'游戏过程中如果有碰到 bug 影响使用, 麻烦向作者反馈一份, 感谢!<img src="/pictures/bili-small-shrink/7/151.png" style="display: inline; width: 48px; height: 48px;"></img><br>QQ1837009039<br><a href="mailto: 1837009039@qq.com">发送邮件</a>'}],Jr=['平局(〃\'▽\'〃)','你赢了(￣▽￣)／','胜负已定(￣.￣)'],Nr=[,,'简单',,'一般',,'较难',,'大爷'],Dr={N:15,level:2,playerFirst:!0,number:!1,boardSize:576,rWidth:180,godMode:!1,lineColor:'#000C',mptColor:'#0C8',moppColor:'#F80',mtipColor:'#F0F',scale:2,storage:1},Or=['无','sessionStorage','localStorage'];function Wr(r){return r+'px'}function _r(r,n){for(var a=Array(r),t=0;t<r;t++)a[t]=n(t);return a}function Fr(){return 0}function qr(r,n,a,t){r.beginPath(),r.arc(n,a,t,0,2*Math.PI),r.fill(),r.stroke()}function Qr(r,n){return r(),setInterval(r,n)}function zr(n,a){return function(r){n(a)}}function Er(r){return document.createElement(r)}function Pr(r,n){r.appendChild(n)}const jr={g:0,$:1,S:2,A:3},Br={reset:'重来',M:'退回',C:'提示',I:'棋序',info:'信息',J:'帮助'};if(!this.document){function m(r,n,a,t){for(var e=_r(n,function(){return[0,0]}),o=0,f=4;f<n;f++){for(var i=0,c=!1,u=0,v=0;v<5;v++){switch(r[f-v]){case 1:s=f-v,i++,0==u&&(u=f-v);break;case 2:f+=4-v,c=!0}if(c)break}c||i<2||(5!=i?(l=2*i-2)>e[s][0]&&(e[s]=[l,u]):o++)}for(f=5;f<n;f++){var s,i=0,c=!1,u=0;if(0==r[f-5]&&0==r[f]){for(var l,v=0;v<6;v++){switch(r[f-v]){case 1:s=f-v,i++,0==u&&(u=f-v);break;case 2:f+=5-v,c=!0}if(c)break}c||0==i||2==i&&1<u-s||(l=2*i-1)>e[s][0]&&(e[s]=[l,u])}}for(f=0;f<8;f++)a[f]=0;for(var b=0,f=0;f<n;f++)0!=e[f][0]&&e[f][1]>b&&(a[e[f][0]-1]++,t[e[f][0]-1]++,b=e[f][1]);a[7]+=o,t[7]+=o}function a(r,n){for(var a=_r(2,function(){return _r(4,function(r){return _r(r<2?n:2*n-9,function(){return _r(8,Fr)})})}),t=_r(2,function(){return _r(8,Fr)}),e=Array(n),o=0;o<2;o++){var f=[0,2,2];f[o+1]=1;for(var i=0;i<n;i++){for(var c=0;c<n;c++)e[c]=f[r[i][c]];for(m(e,n,a[o][0][i],t[o]),c=0;c<n;c++)e[c]=f[r[c][i]];m(e,n,a[o][1][i],t[o])}for(i=0;i<2*n-9;i++){var u=n-5-i,v=0,s=i+5;for(u<0&&(v=-u,u=0,s=2*n-5-i),c=0;c<s;c++)e[c]=f[r[u+c][v+c]];for(m(e,s,a[o][2][i],t[o]),u=0,s=i+5,n<=(v=4+i)&&(u=v-n+1,v=n-1,s=2*n-5-i),c=0;c<s;c++)e[c]=f[r[u+c][v-c]];m(e,s,a[o][3][i],t[o])}}return[a,t]}function y(r,n,a,t,e,o,f){var i={},c=Array(n);function u(r){for(var n=Array(8),a=0;a<8;a++)n[a]=r[a];return n}function v(r,n){for(var a=0;a<8;a++)r[a]-=n[a]}i.N=[a,t],i.all=[u(f[0]),u(f[1])],r[t][a]=e,i[0]=[u(o[0][0][t]),u(o[1][0][t])],v(f[0],o[0][0][t]),v(f[1],o[1][0][t]);for(var s=0;s<2;s++){(p=[0,2,2])[s+1]=1;for(var l=0;l<n;l++)c[l]=p[r[t][l]];m(c,n,o[s][0][t],f[s])}for(i[1]=[u(o[0][1][a]),u(o[1][1][a])],v(f[0],o[0][1][a]),v(f[1],o[1][1][a]),s=0;s<2;s++){for((p=[0,2,2])[s+1]=1,l=0;l<n;l++)c[l]=p[r[l][a]];m(c,n,o[s][1][a],f[s])}var b=n+a-t-5;if(0<=b&&b<2*n-9){i[2]=[u(o[0][2][b]),u(o[1][2][b])],v(f[0],o[0][2][b]),v(f[1],o[1][2][b]);var h=0,d=b+5;for((k=n-5-b)<0&&(h=-k,k=0,d=2*n-5-b),s=0;s<2;s++){for((p=[0,2,2])[s+1]=1,l=0;l<d;l++)c[l]=p[r[k+l][h+l]];m(c,d,o[s][2][b],f[s])}}if(0<=(b=a+t-4)&&b<2*n-9){i[3]=[u(o[0][3][b]),u(o[1][3][b])],v(f[0],o[0][3][b]),v(f[1],o[1][3][b]);var k=0,d=b+5;n<=(h=4+b)&&(k=h-n+1,h=n-1,d=2*n-5-b);for(var p,s=0;s<2;s++){for((p=[0,2,2])[s+1]=1,l=0;l<d;l++)c[l]=p[r[k+l][h-l]];m(c,d,o[s][3][b],f[s])}}return i}this.addEventListener('message',function(r){var[n,a,t,r]=r.data;(t=e(n,a,r,t))?this.postMessage([!0,t]):this.postMessage([!1])});const M={D:0,O:1,W:2},s=[10,10,60,70,150,180,1e3,1200];function g(r,n){for(var a=n-1,n=2-n,t=[0,0],e=0;e<2;e++)for(var o=0;o<5;o++)t[e]+=r[e][o]*s[o];return 0==(n=t[a]-t[n])?M.D:0<n?M.O:M.W}function S(r,n,a){var t=n-1,e=2-n,o=0;0<r[e][7]?o=-5e5:0<r[t][7]?o=5e5:0<r[e][6]?o=-4e5:0<r[e][5]?o=-3e5:0<r[t][6]||1<r[t][5]?o=3e5:0<r[t][5]&&0<r[t][4]?o=2e5:0<r[e][4]?o=-1e5:1<r[t][4]&&(o=1e5);var n=0,f=0,i=0,c=[0,0];switch(a){case M.D:f=i=5;break;case M.O:f=6,i=4;break;case M.W:f=4,i=6}for(var u=0;u<2;u++)for(var v=0;v<8;v++)c[u]+=r[u][v]*s[v];return o+((n=1e5<=(n=c[t]*f-c[e]*i)?99999:n)<=-1e5?-99999:n)}function A(r,n,a,t,e){for(var o=0;o<2;o++)for(var f=0;f<8;f++)t[o][f]=e.all[o][f];var[i,c]=e.N;a[0][0][c]=e[0][0],a[1][0][c]=e[0][1],a[0][1][i]=e[1][0],a[1][1][i]=e[1][1];var u=n+i-c-5;0<=u&&u<2*n-9&&(a[0][2][u]=e[2][0],a[1][2][u]=e[2][1]),0<=(u=i+c-4)&&u<2*n-9&&(a[0][3][u]=e[3][0],a[1][3][u]=e[3][1]),r[c][i]=0}function x(r,n,a,t,e,o){for(var f,i=[],c=_r(n,function(){return _r(n,Fr)}),u=g(o,e),v=0;v<n;v++)for(var s=0;s<n;s++)if(0!=r[v][s]){var l=v-2,b=s-2,h=v+3,d=s+3;b<0&&(b=0),n<h&&(h=n),n<d&&(d=n);for(var k=l=l<0?0:l;k<h;k++)for(var p=b;p<d;p++)c[k][p]=1}for(v=0;v<n;v++)for(s=0;s<n;s++)0==r[v][s]&&0!=c[v][s]&&(f=y(r,n,s,v,a,e,o),mark=S(o,a,u),A(r,n,e,o,f),i.push([mark,[v,s]]));return i.sort(function(r,n){return n[0]-r[0]}),i.length<=t||(i.length=t),i}function e(d,k,p,r){const m=[12,10,9,8,7,6,5,5];var[g,n]=function(){for(var r,n=0,a=0;a<d;a++)for(var t=0;t<d;t++)0!=k[a][t]&&(n++,r=[t,a]);var e=Math.floor(d/2);if(0==n)return[[e,e]];if(1!=n)return[!1,n];if(r[0]==e&&r[1]==e)return 4<=(f=7<(f=Math.floor(8*Math.random()))?7:f)&&f++,f=(f-(o=f%3))/3,[[e+--o,e+--f]];var e=d/2,o=r[0]<e?1:r[0]>e?-1:0,f=r[1]<e?1:r[1]>e?-1:0;return[[r[1]+f,r[0]+o]]}();if(g)return g;if(0==(p=(n=d*d-n)<p?n:p))return!1;var[w,$]=a(k,d);return function r(n,a,t,e){if(a==p)return S($,3-n,M.D);for(var o=a<8?m[a]:4,f=x(k,d,n,o,w,$),o=f.length,i=3-n,c=a+1,u=(p-a)%2==0,v=0;v<o;v++){var s=f[v][1][1],l=f[v][1][0],b=y(k,d,s,l,n,w,$),h=0<$[n-1][7]?S($,u?i:n,M.D)+5e5*(u?c-p:p-c):r(i,c,t,e);if(u?h<e&&(e=h,0==a&&(g=[l,s])):t<h&&(t=h,0==a&&(g=[l,s])),A(k,d,w,$,b),e<=t)break}return u?e:t}(r,0,-(n=1e6+5e5*p),n),g}}function loadGobangGame(r,n,a,t){var e=document.getElementById(r);if(!e)return console.warn(`No object names '${r}'`),!1;function o(r,n){return n||0==v||void 0===(n=f(r))?(t&&void 0!==t[r]?t:Dr)[r]:n}var u,v=o('storage',!0);switch(v){case 0:u=null;break;case 1:sessionStorage?u=sessionStorage:v=0;break;case 2:localStorage?u=localStorage:v=0;break;default:v=0}function f(r){if(0!=v){var n,a,t=u.getItem(Mr);try{n=JSON.parse(t)}catch(r){n={}}return n?n[r]:a}}function s(r,n){if(0!=v){var a,t=u.getItem(Mr);try{a=JSON.parse(t)}catch(r){}(a=a||{})[r]=n,u.setItem(Mr,JSON.stringify(a))}}function i(r,n){s('board_data',JSON.stringify(r)),s('board_first',n)}function c(r){if(0!=v){var n,a=u.getItem(Mr);try{n=JSON.parse(a)}catch(r){}n&&(n[r]=void 0,u.setItem(Mr,JSON.stringify(n)))}}function l(r,n,a){(a=Er(a||'p')).innerHTML=n,Pr(r,a)}function b(r){var n=Er('fieldset'),a=Er('legend');return n.style.marginBottom=Wr(N),a.innerHTML=r,Pr(n,a),n}var h,d,k=o('N'),p=o('boardSize'),m=o('rWidth'),g=o('scale'),w=o('godmode'),$=o('lineColor'),y=o('mptColor'),S=o('moppColor'),A=o('mtipColor'),x=o('playerFirst'),M=o('level'),C=o('number'),I=0,J=p*g,N=p/30,D=Er('div'),O=Er('div');O.tabIndex=0,O.style.margin='auto',O.style.userSelect='none',O.style.textAlign='left',O.style.position='relative',O.style.width='fit-content',O.style.display='flex',O.style.flexDirection='column';var W=Er('div');W.style.flexGrow=1,W.style.display='flex';var _=Er('span');_.style.display='block',_.style.margin=Wr(N),_.style.marginTop=0;var F=Er('canvas');F.width=F.height=J,F.style.width=F.style.height=Wr(p),F.style.margin=Wr(N);var q=F.getContext('2d');(r=Er('div')).style.width=Wr(m),r.style.padding=Wr(N),r.style.display='flex',r.style.flexDirection='column',(g=Er('div')).style.flexGrow=1,g.style.display='flex',g.style.flexDirection='column',g.style.justifyContent='center',g.style.alignItems='center';var Q,z,E=Er('span');function P(r,n){r.style.position='absolute',r.style.left=r.style.top=0,r.style.width=r.style.height='100%',r.style.padding=r.style.margin=0,r.style.zIndex=n}function j(u){Z||(function(r,n){var a=r.style.display;r.style.display='flex',r.style.flexDirection='column';var t=Er('div');t.style.padding=Wr(N),t.style.overflowY='auto',t.style.flexGrow=1;var e=Er('div');function o(){r.style.display=a,n()}e.style.padding=Wr(N),e.style.display='flex',e.style.justifyContent='flex-end';var f=[{name:'确定',_:o}];u(t,f,o);for(var i=0;i<f.length;i++){var c=Er('button');c.innerText=f[i].name,c.style.paddingLeft=c.style.paddingRight=c.style.marginLeft=Wr(N),c.addEventListener('click',f[i]._),Pr(e,c)}Pr(r,t),Pr(r,e)}(z,function(){z.innerHTML='',Q.hidden=z.hidden=!0,Z=!1}),Q.hidden=z.hidden=!1,Z=!0)}function B(){q.resetTransform(),q.clearRect(0,0,J,J);var r=J/k,n=r/2,a=r/40;q.beginPath(),q.lineWidth=a.toString(),q.strokeStyle=$;for(var t=0;t<k;t++)q.moveTo(n,r*(t+.5)),q.lineTo(J-n,r*(t+.5)),q.moveTo(r*(t+.5),n),q.lineTo(r*(t+.5),J-n);q.stroke();var e=.4*r,o=q.createRadialGradient(.4*e,.4*-e,0,e/4,-e/4,.7*e);o.addColorStop(0,'#CCC'),o.addColorStop(1,'black');var f=q.createRadialGradient(.4*e,.4*-e,0,e/4,-e/4,.7*e);f.addColorStop(0,'white'),f.addColorStop(1,'#DDD');for(var i,c=0;c<V.length;c++){var t=V[c][1],u=V[c][0];q.resetTransform(),q.translate(r*(t+.5),r*(u+.5)),c%2==0?(q.strokeStyle='black',q.fillStyle=o):(q.strokeStyle='#DDD',q.fillStyle=f),qr(q,0,0,e)}if(U&&(t=U[1],u=U[0],i=.16*r,q.fillStyle=S,q.resetTransform(),q.translate(r*(t+.5),r*(u+.5)),q.fillRect(-i,-i,2*i,2*i)),H&&(t=H[1],u=H[0],i=.13*r,q.fillStyle=A,q.resetTransform(),q.translate(r*(t+.5),r*(u+.5)),q.fillRect(-i,-i,2*i,2*i)),T&&(t=T[1],u=T[0],i=.1*r,q.fillStyle=y,q.resetTransform(),q.translate(r*(t+.5),r*(u+.5)),q.fillRect(-i,-i,2*i,2*i)),q.font=`${Math.round(2*r/5)}px Arial`,q.textAlign='center',q.textBaseline='middle',C)for(c=0;c<V.length;c++)t=V[c][1],u=V[c][0],q.resetTransform(),q.translate(r*(t+.5),r*(u+.5)),q.fillStyle=c%2==0?'white':'black',q.fillText(c+1,0,0)}function G(){d&&d.terminate(),(d=new Worker(n)).addEventListener('message',K)}function K(r){var n,r=r.data;Y&&h==jr.$?(n=r[1],clearInterval(L),r[0]?(sr(n[1],n[0]),H=n,B()):vr('没有可行方案'),Y=!1):!Y&&h==jr.S&&r[0]&&er((n=r[1])[1],n[0])}Pr(r,g),Pr(r,E),Pr(W,F),Pr(W,r),Pr(O,W),Pr(O,_),Pr(D,O),Pr(e,D),(E=E).style.color='#444',E.style.fontSize=Wr(.7*N),E.style.textAlign='center',E.innerText=`${Ar} v${xr}`,E.addEventListener('click',function(){j(function(r,n,a){l(r,Ar,'h2'),l(r,'版本: '+xr+'<br>作者: KillTimer'),l(r,'更新内容','h2');var t,e='';for(t in Cr){e+=`<h3>${Cr[t][0]}</h3>`;for(var o=1;o<Cr[t].length;o++)1!=o&&(e+='<br>'),e+=Cr[t][o]}l(r,e),n.unshift({name:'帮助',_:function(){a(),ir()}})})}),function(r){var n=m/2,a=!0;function t(r){r.style.width=Wr(n),r.style.display='block',r.style.paddingTop=r.style.paddingBottom=Wr(3),a?a=!1:r.style.marginTop=Wr(N),r.style.textAlign='center'}var e,o=Er('select');o.style.appearance='none',(e=Er('option')).value=0,e.innerText='我先手',Pr(o,e),(e=Er('option')).value=1,e.innerText='我后手',Pr(o,e),o[c=x?0:1].selected=!0,t(o),o.addEventListener('change',function(r){s('playerFirst',x=0==o.value)}),Pr(r,o);var f=Er('select');f.style.appearance='none';for(var i,c=0;c<Nr.length;c++)Nr[c]&&((e=Er('option')).value=c,e.innerText=Nr[c],c==M&&(e.selected=!0),Pr(f,e));t(f),f.addEventListener('change',function(r){var n=parseInt(f.value);0<n&&s('level',M=n)}),Pr(r,f);for(const u in Br)t(i=Er('button')),i.innerText=Br[u],i.addEventListener('click',zr(Sr,Br[u])),Pr(r,i)}(g),P(Q=Er('div'),1e4),Q.style.background='white',Q.style.opacity=.7,Q.hidden=!0,P(z=Er('div'),12e3),z.style.userSelect='text',z.hidden=!0,z.style.overflowY='auto',Pr(O,z),Pr(O,Q);var L,R,T,U,H,V,X,Y,Z=!1,rr=0;function nr(){for(var r='计算机思考中',n=0;n<=rr;n++)r+='.';vr(r),3<=++rr&&(rr=0)}function ar(){for(var r='计算中',n=0;n<=rr;n++)r+='.';vr(r),3<=++rr&&(rr=0)}function tr(){if(h!=jr.g){for(var r=0,n=0;n<k;n++){for(var a=4;a<k;a++){for(var t=1;t<=2&&!(r=o(t,R[n][a],R[n][a-1],R[n][a-2],R[n][a-3],R[n][a-4])?t:r)&&!(r=o(t,R[a][n],R[a-1][n],R[a-2][n],R[a-3][n],R[a-4][n])?t:r);t++);if(r)break}if(r)break}for(n=4;n<k;n++){for(a=4;a<k;a++){for(t=1;t<=2&&!(r=o(t,R[n][a],R[n-1][a-1],R[n-2][a-2],R[n-3][a-3],R[n-4][a-4])?t:r)&&!(r=o(t,R[n-4][a],R[n-3][a-1],R[n-2][a-2],R[n-1][a-3],R[n][a-4])?t:r);t++);if(r)break}if(r)break}if(r)return h=jr.A,I=r,1;for(var e=0,n=0;n<k;n++)for(a=0;a<k;a++)0!=R[a][n]&&e++;return e==k*k&&(h=jr.A,I=0,1)}function o(r,n,a,t,e,o){return n==r&&a==r&&t==r&&e==r&&o==r&&r}}function er(r,n){switch(h){case jr.g:if(V.length){for(var a=!!X==(V.length%2==0),t=V.pop(),e=0;e<V.length;e++)R[V[e][0]][V[e][1]]=e%2+1;return h=a?jr.S:jr.$,void er(t[1],t[0])}h=X?jr.$:jr.S,er(t=Math.floor(k/2),t);break;case jr.$:cr(r,n,1),h=jr.S,tr()?er():(Y&&(G(),clearInterval(L),Y=L=!1),d.postMessage([k,R,2,M]),L=Qr(nr,1e3)),B();break;case jr.S:U=[n,r],cr(r,n,2),h=jr.$,L&&(clearInterval(L),L=!1,rr=0),sr(r,n),tr()&&er(),B();break;case jr.A:c('board_data'),c('board_first'),vr(Jr[I])}}function or(){var r=0;switch(H=!1,h){case jr.$:r=2;break;case jr.S:G(),L&&(clearInterval(L),L=!1),h=jr.$,r=1;break;case jr.A:r=((X?1:0)+V.length)%2+1,h=jr.$}if(0!=r)if(V.length>=r){for(;r--;){var n=V.pop();R[n[0]][n[1]]=0}i(V,X),0<V.length?(n=V[V.length-1],U=[n[0],n[1]],sr(n[1],n[0]),B()):(h=jr.g,U=!1,er())}else vr('已经是开局了')}const fr=[{name:'坐标式:',_:function(r){for(var n,a,t='',e=0;e<r.length;e++)n=r[e][1],a=r[e][0],0!=e&&(t+=' '),t+=String.fromCharCode(n+65)+(a+1);return t}},{name:'数组式:',_:function(r){for(var n,a='[',t=0;t<r.length;t++)0!=t&&(a+=', '),n=r[t][1],a+=`[${r[t][0]}, ${n}]`;return a+']'}},{name:'分组式:',_:function(r){for(var n,a,t='',e='',o=0;o<r.length;o++)n=r[o][1],a=r[o][0],o%2==0?(0!=o&&(t+=', '),t+=`[${a}, ${n}]`):(1!=o&&(e+=', '),e+=`[${a}, ${n}]`);return`[[${t}], [${e}]]`}}];function ir(){j(function(r){l(r,Br.J,'h2'),l(r,Ir[0].t);for(var n=1;n<Ir.length;n++){var a=Er('h3');a.innerText=Ir[n].name,Pr(r,a),(a=Er('p')).style.wordBreak='break-word',a.innerHTML=Ir[n].t,Pr(r,a)}})}function cr(r,n,a){R[n][r]=a,V.push([n,r]),i(V,X)}function ur(r){var n;G(),Y=!1,L&&(clearInterval(L),L=!1),h=jr.g,X=x,R=_r(k,function(){return _r(k,Fr)}),T=U=H=!1,V=null,r&&([V,n]=function(){var r,n,a=f('board_data'),t=!!f('board_first');try{r=JSON.parse(a)}catch(r){}if(Array.isArray(r)&&r.length<k*k){n=[];try{for(var e=0;e<r.length;e++)n.push([r[e][0],r[e][1]]);return[n,t]}catch(r){}}return[]}()),V?X=n:V=[],i(V,X),er()}function vr(r){_.innerText=r}function sr(r,n){vr(`[${n}, ${r}]`)}function lr(r,n){return[r=(r=Math.floor(r/p*k))<0?0:k<=r?k-1:r,n=(n=Math.floor(n/p*k))<0?0:k<=n?k-1:n]}function br(r,n){T&&r==T[1]&&n==T[0]||(h!=jr.$||Y||sr(r,n),T=[n,r],B())}function hr(r,n){h==jr.$?0==R[n][r]||w?(H=!1,er(r,n)):vr('该点已经有子'):h==jr.S&&vr('计算机正在思考')}'function'==typeof a&&a(O,F,r,_),ur(!0),F.addEventListener('mousemove',function(r){var[n,a]=lr(r.offsetX,r.offsetY);br(n,a),r.preventDefault()}),F.addEventListener('click',function(r){var[n,r]=lr(r.offsetX,r.offsetY);hr(n,r)});var dr,kr,pr,mr,gr,wr=0,$r=p*p/(k*k);function yr(r){var n=F.getBoundingClientRect();return[Math.round(r.clientX-n.x),Math.round(r.clientY-n.y)]}function Sr(r){switch(r){case Br.M:or();break;case Br.reset:ur();break;case Br.C:h!=jr.$||Y||(d.postMessage([k,R,1,M]),L=Qr(ar,1e3),Y=!0);break;case Br.I:s('number',C=!C),B();break;case Br.info:!function c(){j(function(r,n,a){for(var t in l(r,Br.info,'h2'),l(r,`第 ${V.length} 手`),l(r,`先手: ${X?'玩家':'电脑'}`),l(r,`难度: ${Nr[M]}(${M})`),i=b('<h3>棋局信息</h3>'),fr)t=fr[t],(e=Er('h4')).innerHTML=t.name,e.style.marginTop=e.style.marginBottom=0,Pr(i,e),(o=Er('p')).style.maxHeight=Wr(p/3),o.style.overflowY='auto',o.style.wordBreak='break-word',o.innerText=t._(V),Pr(i,o);Pr(r,i);var e,o,f=`${Mr}: ${Or[v]} (${v})`,i=b('<h3>存储</h3>');(e=Er('p')).innerHTML=f,e.style.marginTop=e.style.marginBottom=0,Pr(i,e),0!=v&&((f=function(){if(0!=v)return u.getItem(Mr)}())&&''!=f||(f='无存储的数据'),(o=Er('p')).style.maxHeight=Wr(p/3),o.style.overflowY='auto',o.style.wordBreak='break-word',o.innerText=f,Pr(i,o)),Pr(r,i),n.unshift({name:'清空存储数据',_:function(){0!=v&&u.removeItem(Mr),a(),c()}})})}();break;case Br.J:ir()}}F.addEventListener('touchstart',function(r){var n;1==r.touches.length&&([dr,kr]=yr(r.touches[0]),wr=0,[n,r]=lr(dr,kr),br(n,r),gr=!0)}),F.addEventListener('touchmove',function(r){var n,a,t,e;1==r.touches.length&&gr?([n,a]=yr(r.touches[0]),0==wr?3*$r<=(t=n-dr)*t+(e=a-kr)*e&&(wr=1,pr=Math.round(3*Math.sqrt(20*$r)/5),mr=Math.round(4*Math.sqrt(20*$r)/5)):(t=n-pr,e=a-mr,n<0||a<0||p<=t||p<=e?(T=!1,B()):([t,e]=lr(t,e),br(t,e))),r.preventDefault()):gr=!1}),F.addEventListener('touchend',function(r){T&&hr(T[1],T[0]),r.preventDefault()}),O.addEventListener('keydown',function(r){if(T&&!Z&&!r.ctrlKey&&!r.altKey&&!r.shiftKey&&!r.metaKey){var n,a,t,e=!0;switch(r.key){case'ArrowLeft':case'a':n=[0,-1];break;case'ArrowRight':case'd':n=[0,1];break;case'ArrowUp':case'w':n=[-1,0];break;case'ArrowDown':case's':n=[1,0];break;case'Enter':case' ':hr(T[1],T[0]);break;case'q':or();break;default:e=!1}n&&([a,t]=T,a+=n[0],t+=n[1],T=[a=a<0?0:k<=a?k-1:a,t=t<0?0:k<=t?k-1:t],h!=jr.$||Y||sr(t,a),B()),e&&r.preventDefault()}})}