const hr='JS五子棋',rr='2.2.2',Pr='GobangItem_CAFEBABE',pr=[['2.2','.0 又双叒叕修复了 AI 的一个严重 bug','.1 增加棋序数字等信息, 增加帮助页面','.1 点击棋盘获取焦点后支持键盘操作','.2 支持使用 storage 保存用户设置'],['2.1','.0 修复 AI 在必输局面下乱走的 bug','.0 拖动落子逻辑修改'],['2.0','使用 WebWorker, 速度优化','重构代码, 修复了 AI 的一些严重 bug','布局优化, 解决 canvas 模糊的问题','可自定义先手和难度','移动端增加拖动落子']],Fr=[{S:'这是一个用 JS 开发的五子棋小游戏, 目标是能方便地嵌入其他网页中并流畅运行, 所以程序并没有调用外部资源或第三方库.<br>游戏中使用了 WebWorker 进行密集型计算(也就是 AI 部分). 相比于 1.0, 由于这种方式另开一个线程, 因此界面流畅程度有了很大的提升, 效率也高了很多.<br>灵感来自于<a target="_blank" href="https://tieba.baidu.com/p/4218602810">贴吧</a>, 按着逻辑重写了一遍并加入了更多内容<br>游戏仍在开发中, 目前在考虑加入禁手规则<del>和万宁五子棋</del><img src="/pictures/bili-small-shrink/1/26.png" style="display: inline; width: 48px; height: 48px;"></img>'},{name:'操作相关',S:'<h4>鼠标</h4>点击落子, 右边可以自定义先手(下一局开始生效)和难度. 在移动端可以通过按住棋盘并滑动来调整落子位置.<h4>键盘</h4><table><col width="150"/><tr><td>WASD / 方向键</td><td>移动光标</td></tr><tr><td>空格 / 回车</td><td>落子</td></tr><tr><td>Q</td><td>悔棋</td></tr>'},{name:'反馈',S:'游戏过程中如果有碰到 bug 影响使用, 麻烦向作者反馈一份, 感谢!<img src="/pictures/bili-small-shrink/7/151.png" style="display: inline; width: 48px; height: 48px;"></img><br>QQ1837009039<br><a href="mailto: 1837009039@qq.com">发送邮件</a>'}],nr=['平局(〃\'▽\'〃)','你赢了(￣▽￣)／','胜负已定(￣.￣)'],gr=[,,'简单',,'一般',,'较难',,'大爷'],Qr={N:15,level:2,playerFirst:!0,boardSize:576,rWidth:180,godMode:!1,lineColor:'#000C',mptColor:'#0C8',moppColor:'#F80',mtipColor:'#F0F',scale:2,storage:1},_r=['无','sessionStorage','localStorage'];function T(r){return r+'px'}function U(r,n){for(var t=Array(r),a=0;a<r;a++)t[a]=n(a);return t}function X(){return 0}function Y(r,n,t,a){r.beginPath(),r.arc(n,t,a,0,2*Math.PI),r.fill(),r.stroke()}function Z(r,n){return r(),setInterval(r,n)}function _(n,t){return function(r){n(t)}}function yr(r){return document.createElement(r)}function Ar(r,n){r.appendChild(n)}const ar={o:0,t:1,u:2,i:3},or={reset:'重来',v:'退回',k:'提示',W:'棋序',info:'信息',q:'帮助'};if(!this.document){function p(r,n,t,a){for(var e=U(n,function(){return[0,0]}),o=0,i=4;i<n;i++){for(var f=0,c=!1,u=0,v=0;v<5;v++){switch(r[i-v]){case 1:s=i-v,f++,0==u&&(u=i-v);break;case 2:i+=4-v,c=!0}if(c)break}c||f<2||(5!=f?(l=2*f-2)>e[s][0]&&(e[s]=[l,u]):o++)}for(i=5;i<n;i++){var s,f=0,c=!1,u=0;if(0==r[i-5]&&0==r[i]){for(var l,v=0;v<6;v++){switch(r[i-v]){case 1:s=i-v,f++,0==u&&(u=i-v);break;case 2:i+=5-v,c=!0}if(c)break}c||0==f||2==f&&1<u-s||(l=2*f-1)>e[s][0]&&(e[s]=[l,u])}}for(i=0;i<8;i++)t[i]=0;for(var h=0,i=0;i<n;i++)0!=e[i][0]&&e[i][1]>h&&(t[e[i][0]-1]++,a[e[i][0]-1]++,h=e[i][1]);t[7]+=o,a[7]+=o}function a(r,n){for(var t=U(2,function(){return U(4,function(r){return U(r<2?n:2*n-9,function(){return U(8,X)})})}),a=U(2,function(){return U(8,X)}),e=Array(n),o=0;o<2;o++){var i=[0,2,2];i[o+1]=1;for(var f=0;f<n;f++){for(var c=0;c<n;c++)e[c]=i[r[f][c]];for(p(e,n,t[o][0][f],a[o]),c=0;c<n;c++)e[c]=i[r[c][f]];p(e,n,t[o][1][f],a[o])}for(f=0;f<2*n-9;f++){var u=n-5-f,v=0,s=f+5;for(u<0&&(v=-u,u=0,s=2*n-5-f),c=0;c<s;c++)e[c]=i[r[u+c][v+c]];for(p(e,s,t[o][2][f],a[o]),u=0,s=f+5,n<=(v=4+f)&&(u=v-n+1,v=n-1,s=2*n-5-f),c=0;c<s;c++)e[c]=i[r[u+c][v-c]];p(e,s,t[o][3][f],a[o])}}return[t,a]}function D(r,n,t,a,e,o,i){var f={},c=Array(n);function u(r){for(var n=Array(8),t=0;t<8;t++)n[t]=r[t];return n}function v(r,n){for(var t=0;t<8;t++)r[t]-=n[t]}f.l=[t,a],f.all=[u(i[0]),u(i[1])],r[a][t]=e,f[0]=[u(o[0][0][a]),u(o[1][0][a])],v(i[0],o[0][0][a]),v(i[1],o[1][0][a]);for(var s=0;s<2;s++){(m=[0,2,2])[s+1]=1;for(var l=0;l<n;l++)c[l]=m[r[a][l]];p(c,n,o[s][0][a],i[s])}for(f[1]=[u(o[0][1][t]),u(o[1][1][t])],v(i[0],o[0][1][t]),v(i[1],o[1][1][t]),s=0;s<2;s++){for((m=[0,2,2])[s+1]=1,l=0;l<n;l++)c[l]=m[r[l][t]];p(c,n,o[s][1][t],i[s])}var h=n+t-a-5;if(0<=h&&h<2*n-9){f[2]=[u(o[0][2][h]),u(o[1][2][h])],v(i[0],o[0][2][h]),v(i[1],o[1][2][h]);var b=0,d=h+5;for((k=n-5-h)<0&&(b=-k,k=0,d=2*n-5-h),s=0;s<2;s++){for((m=[0,2,2])[s+1]=1,l=0;l<d;l++)c[l]=m[r[k+l][b+l]];p(c,d,o[s][2][h],i[s])}}if(0<=(h=t+a-4)&&h<2*n-9){f[3]=[u(o[0][3][h]),u(o[1][3][h])],v(i[0],o[0][3][h]),v(i[1],o[1][3][h]);var k=0,d=h+5;n<=(b=4+h)&&(k=b-n+1,b=n-1,d=2*n-5-h);for(var m,s=0;s<2;s++){for((m=[0,2,2])[s+1]=1,l=0;l<d;l++)c[l]=m[r[k+l][b-l]];p(c,d,o[s][3][h],i[s])}}return f}this.addEventListener('message',function(r){var[n,a,e,r]=r.data;(e=t(n,a,r,e))?this.postMessage([!0,e]):this.postMessage([!1])});const h={D:0,M:1,g:2},k=[10,10,60,70,150,180,1e3,1200];function M(r,n){for(var t=n-1,n=2-n,a=[0,0],e=0;e<2;e++)for(var o=0;o<5;o++)a[e]+=r[e][o]*k[o];return 0==(n=a[t]-a[n])?h.D:0<n?h.M:h.g}function g(r,n,t){var a=n-1,e=2-n,o=0;0<r[e][7]?o=-5e5:0<r[a][7]?o=5e5:0<r[e][6]?o=-4e5:0<r[e][5]?o=-3e5:0<r[a][6]||1<r[a][5]?o=3e5:0<r[a][5]&&0<r[a][4]?o=2e5:0<r[e][4]?o=-1e5:1<r[a][4]&&(o=1e5);var n=0,i=0,f=0,c=[0,0];switch(t){case h.D:i=f=5;break;case h.M:i=6,f=4;break;case h.g:i=4,f=6}for(var u=0;u<2;u++)for(var v=0;v<8;v++)c[u]+=r[u][v]*k[v];return o+((n=1e5<=(n=c[a]*i-c[e]*f)?99999:n)<=-1e5?-99999:n)}function A(r,n,t,a,e){for(var o=0;o<2;o++)for(var i=0;i<8;i++)a[o][i]=e.all[o][i];var[f,c]=e.l;t[0][0][c]=e[0][0],t[1][0][c]=e[0][1],t[0][1][f]=e[1][0],t[1][1][f]=e[1][1];var u=n+f-c-5;0<=u&&u<2*n-9&&(t[0][2][u]=e[2][0],t[1][2][u]=e[2][1]),0<=(u=f+c-4)&&u<2*n-9&&(t[0][3][u]=e[3][0],t[1][3][u]=e[3][1]),r[c][f]=0}function I(r,n,t,a,e,o){for(var i,f=[],c=U(n,function(){return U(n,X)}),u=M(o,e),v=0;v<n;v++)for(var s=0;s<n;s++)if(0!=r[v][s]){var l=v-2,h=s-2,b=v+3,d=s+3;h<0&&(h=0),n<b&&(b=n),n<d&&(d=n);for(var k=l=l<0?0:l;k<b;k++)for(var p=h;p<d;p++)c[k][p]=1}for(v=0;v<n;v++)for(s=0;s<n;s++)0==r[v][s]&&0!=c[v][s]&&(i=D(r,n,s,v,t,e,o),mark=g(o,t,u),A(r,n,e,o,i),f.push([mark,[v,s]]));return f.sort(function(r,n){return n[0]-r[0]}),f.length<=a||(f.length=a),f}function t(k,p,m,r){const w=[16,12,10,9,8,7,6,5,5];var[$,n]=function(){for(var r,n=0,t=0;t<k;t++)for(var a=0;a<k;a++)0!=p[t][a]&&(n++,r=[a,t]);var e=Math.floor(k/2);if(0==n)return[[e,e]];if(1!=n)return[!1,n];if(r[0]==e&&r[1]==e)return 4<=(i=7<(i=Math.floor(8*Math.random()))?7:i)&&i++,i=(i-(o=i%3))/3,[[e+--o,e+--i]];var e=k/2,o=r[0]<e?1:r[0]>e?-1:0,i=r[1]<e?1:r[1]>e?-1:0;return[[r[1]+i,r[0]+o]]}();if($)return $;if(0==(m=(n=k*k-n)<m?n:m))return!1;var[y,M]=a(p,k);return function r(n,t,a,e){if(t==m)return g(M,3-n,h.D);for(var o=t<9?w[t]:4,i=I(p,k,n,o,y,M),o=i.length,f=3-n,c=t+1,u=(m-t)%2==0,v=0;v<o;v++){var s=i[v][1][1],l=i[v][1][0],b=D(p,k,s,l,n,y,M),d=0<M[n-1][7]?g(M,u?f:n,h.D)+5e5*(u?c-m:m-c):r(f,c,a,e);if(u?d<e&&(e=d,0==t&&($=[l,s])):a<d&&(a=d,0==t&&($=[l,s])),A(p,k,y,M,b),e<=a)break}return u?e:a}(r,0,-(n=1e6+5e5*m),n),$}}function loadGobangGame(r,n,t,a){var e=document.getElementById(r);if(!e)return console.warn(`No object names '${r}'`),!1;function o(r,n){return n||0==s||void 0===(n=function(r){if(0!=s){var n,t,a=v.getItem(Pr);try{n=JSON.parse(a)}catch(r){n={}}return n?n[r]:t}}(r))?(a&&void 0!==a[r]?a:Qr)[r]:n}var v,s=o('storage',!0);switch(s){case 0:v=null;break;case 1:sessionStorage?v=sessionStorage:s=0;break;case 2:localStorage?v=localStorage:s=0;break;default:s=0}function c(r,n){if(0!=s){var t,a=v.getItem(Pr);try{t=JSON.parse(a)}catch(r){}(t=t||{})[r]=n,v.setItem(Pr,JSON.stringify(t))}}var i,f,l=o('N'),h=o('boardSize'),u=o('rWidth'),b=o('scale'),d=o('godmode'),k=o('lineColor'),p=o('mptColor'),m=o('moppColor'),g=o('mtipColor'),w=o('playerFirst'),$=o('level'),A=0,y=h*b,M=h/30,S=yr('canvas');S.width=S.height=y,S.style.width=S.style.height=T(h),S.style.margin=T(M);var C=S.getContext('2d');(F=yr('table')).style.width=T(u),F.style.height=T(h),F.style.padding=T(M),F.style.paddingBottom='0';var I=yr('span'),x=yr('table');function D(r,n){r.style.position='absolute',r.style.left=r.style.top=0,r.style.width=r.style.height='100%',r.style.padding=r.style.margin=0,r.style.zIndex=n}x.tabIndex=0,x.style.margin='auto',x.style.userSelect='none',x.style.position='relative',D(q=yr('div'),1e4),q.style.background='white',q.style.opacity=.7,q.hidden=!0,D(B=yr('div'),12e3),B.style.userSelect='text',B.hidden=!0,B.style.overflowY='auto',Ar(x,B),Ar(x,q);var W=!1,F=yr('td');function N(r,n,t){(t=yr(t||'p')).innerHTML=n,Ar(r,t)}function J(r){var n=yr('fieldset'),t=yr('legend');return n.style.marginBottom=T(M),t.innerHTML=r,Ar(n,t),n}var E,O,q,B,W,Q=yr('tr'),z=yr('td');function P(){f&&f.terminate(),(f=new Worker(n)).addEventListener('message',j)}function j(r){var n,r=r.data;br&&i==ar.t?(n=r[1],clearInterval(L),r[0]?(Sr(n[1],n[0]),vr=n,K()):Mr('没有可行方案'),br=!1):!br&&i==ar.u&&r[0]&&(n=r[1],er((ur=n)[1],n[0]))}function G(u){W||(function(r,n){var t=r.style.display;r.style.display='flex',r.style.flexDirection='column';var a=yr('div');a.style.padding=T(M),a.style.overflowY='auto',a.style.flexGrow=1;var e=yr('div');function o(){r.style.display=t,n()}e.style.padding=T(M),e.style.display='flex',e.style.justifyContent='flex-end';var i=[{name:'确定',P:o}];u(a,i,o);for(var f=0;f<i.length;f++){var c=yr('button');c.innerText=i[f].name,c.style.paddingLeft=c.style.paddingRight=c.style.marginLeft=T(M),c.addEventListener('click',i[f].P),Ar(e,c)}Ar(r,a),Ar(r,e)}(B,function(){B.innerHTML='',q.hidden=B.hidden=!0,W=!1}),q.hidden=B.hidden=!1,W=!0)}function K(){C.resetTransform(),C.clearRect(0,0,y,y);var r=y/l,n=r/2,t=r/40;C.beginPath(),C.lineWidth=t.toString(),C.strokeStyle=k;for(var a=0;a<l;a++)C.moveTo(n,r*(a+.5)),C.lineTo(y-n,r*(a+.5)),C.moveTo(r*(a+.5),n),C.lineTo(r*(a+.5),y-n);C.stroke();var e=.4*r,o=C.createRadialGradient(.4*e,.4*-e,0,e/4,-e/4,.7*e);o.addColorStop(0,'#CCC'),o.addColorStop(1,'black');var i=C.createRadialGradient(.4*e,.4*-e,0,e/4,-e/4,.7*e);i.addColorStop(0,'white'),i.addColorStop(1,'#DDD');for(var f,c=0;c<sr.length;c++){var a=sr[c][1],u=sr[c][0];C.resetTransform(),C.translate(r*(a+.5),r*(u+.5)),c%2==0?(C.strokeStyle='black',C.fillStyle=o):(C.strokeStyle='#DDD',C.fillStyle=i),Y(C,0,0,e)}if(ur&&(a=ur[1],u=ur[0],f=.16*r,C.fillStyle=m,C.resetTransform(),C.translate(r*(a+.5),r*(u+.5)),C.fillRect(-f,-f,2*f,2*f)),vr&&(a=vr[1],u=vr[0],f=.13*r,C.fillStyle=g,C.resetTransform(),C.translate(r*(a+.5),r*(u+.5)),C.fillRect(-f,-f,2*f,2*f)),cr&&(a=cr[1],u=cr[0],f=.1*r,C.fillStyle=p,C.resetTransform(),C.translate(r*(a+.5),r*(u+.5)),C.fillRect(-f,-f,2*f,2*f)),C.font=`${Math.round(2*r/5)}px Arial`,C.textAlign='center',C.textBaseline='middle',dr)for(c=0;c<sr.length;c++)a=sr[c][1],u=sr[c][0],C.resetTransform(),C.translate(r*(a+.5),r*(u+.5)),C.fillStyle=c%2==0?'white':'black',C.fillText(c+1,0,0)}Ar(z,S),Ar(Q,z),(z=yr('td')).style.width=T(u),z.style.height=T(h),(r=yr('table')).style.width=T(u),r.style.height=T(h),r.style.padding=T(M),r.style.paddingBottom='0',Ar(b=yr('tr'),F),Ar(r,b),(b=yr('tfoot')).style.textAlign='center',b.style.cursor='pointer',E=b,(O=yr('span')).style.color=k,O.style.fontSize=T(.7*M),O.innerText=`${hr} v${rr}`,Ar(E,O),b.addEventListener('click',function(r){G(function(r,n,t){N(r,hr,'h2'),N(r,'版本: '+rr+'<br>作者: KillTimer'),N(r,'更新内容','h2');var a,e='';for(a in pr){e+=`<h3>${pr[a][0]}</h3>`;for(var o=1;o<pr[a].length;o++)1!=o&&(e+='<br>'),e+=pr[a][o]}N(r,e),n.unshift({name:'帮助',P:function(){t(),mr()}})})}),Ar(r,b),Ar(z,r),Ar(Q,z),Ar(x,Q),Q=yr('tr'),(z=yr('td')).rowSpan='2',Ar(z,I),Ar(Q,z),Ar(x,Q),Ar(e,x),function(){var n=u/2;function r(r){r.style.width=T(n),r.style.display='block',r.style.marginLeft=r.style.marginRight='auto',r.style.marginBottom=T(M),r.style.paddingTop=r.style.paddingBottom=T(3),r.style.textAlign='center'}var t,a=yr('select');a.style.appearance='none',(t=yr('option')).value=0,t.innerText='我先手',Ar(a,t),(t=yr('option')).value=1,t.innerText='我后手',Ar(a,t),a[i=w?0:1].selected=!0,r(a),a.addEventListener('change',function(r){c('playerFirst',w=0==a.value)}),Ar(F,a);var e=yr('select');e.style.appearance='none';for(var o,i=0;i<gr.length;i++)gr[i]&&((t=yr('option')).value=i,t.innerText=gr[i],i==$&&(t.selected=!0),Ar(e,t));r(e),e.addEventListener('change',function(r){var n=parseInt(e.value);0<n&&c('level',$=n)}),Ar(F,e);for(const f in or)r(o=yr('button')),o.innerText=or[f],o.addEventListener('click',_(zr,or[f])),Ar(F,o)}();var L,R=0;function H(){for(var r='计算机思考中',n=0;n<=R;n++)r+='.';Mr(r),3<=++R&&(R=0)}function V(){for(var r='计算中',n=0;n<=R;n++)r+='.';Mr(r),3<=++R&&(R=0)}function tr(){if(i!=ar.o){for(var r=0,n=0;n<l;n++){for(var t=4;t<l;t++){for(var a=1;a<=2&&!(r=o(a,fr[n][t],fr[n][t-1],fr[n][t-2],fr[n][t-3],fr[n][t-4])?a:r)&&!(r=o(a,fr[t][n],fr[t-1][n],fr[t-2][n],fr[t-3][n],fr[t-4][n])?a:r);a++);if(r)break}if(r)break}for(n=4;n<l;n++){for(t=4;t<l;t++){for(a=1;a<=2&&!(r=o(a,fr[n][t],fr[n-1][t-1],fr[n-2][t-2],fr[n-3][t-3],fr[n-4][t-4])?a:r)&&!(r=o(a,fr[n-4][t],fr[n-3][t-1],fr[n-2][t-2],fr[n-1][t-3],fr[n][t-4])?a:r);a++);if(r)break}if(r)break}if(r)return i=ar.i,A=r,1;for(var e=0,n=0;n<l;n++)for(t=0;t<l;t++)0!=fr[t][n]&&e++;return e==l*l&&(i=ar.i,A=0,1)}function o(r,n,t,a,e,o){return n==r&&t==r&&a==r&&e==r&&o==r&&r}}function er(r,n){switch(i){case ar.o:i=lr?ar.t:ar.u;var t=Math.floor(l/2);lr||(ur=[t,t]),er(t,t);break;case ar.t:wr(r,n,1),i=ar.u,tr()?er():(br&&(P(),clearInterval(L),br=L=!1),f.postMessage([l,fr,2,$]),L=Z(H,1e3)),K();break;case ar.u:wr(r,n,2),i=ar.t,L&&(clearInterval(L),L=!1,R=0),Sr(r,n),tr()&&er(),K();break;case ar.i:Mr(nr[A])}}function ir(){var r=0;switch(vr=!1,i){case ar.t:r=2;break;case ar.u:P(),L&&(clearInterval(L),L=!1),i=ar.t,r=1;break;case ar.i:r=((lr?1:0)+sr.length)%2+1,i=ar.t}if(0!=r)if(sr.length>=r){for(;r--;){var n=sr.pop();fr[n[0]][n[1]]=0}0<sr.length?(n=sr[sr.length-1],ur=[n[0],n[1]],Sr(n[1],n[0]),K()):(i=ar.o,ur=!1,er())}else Mr('已经是开局了')}var fr,cr,ur,vr,sr,lr,br,dr=!1;const kr=[{name:'坐标式:',P:function(r){for(var n,t,a='',e=0;e<r.length;e++)n=r[e][1],t=r[e][0],0!=e&&(a+=' '),a+=String.fromCharCode(n+65)+(t+1);return a}},{name:'数组式:',P:function(r){for(var n,t='[',a=0;a<r.length;a++)0!=a&&(t+=', '),n=r[a][1],t+=`[${r[a][0]}, ${n}]`;return t+']'}},{name:'分组式:',P:function(r){for(var n,t,a='',e='',o=0;o<r.length;o++)n=r[o][1],t=r[o][0],o%2==0?(0!=o&&(a+=', '),a+=`[${t}, ${n}]`):(1!=o&&(e+=', '),e+=`[${t}, ${n}]`);return`[[${a}], [${e}]]`}}];function mr(){G(function(r){N(r,or.q,'h2'),N(r,Fr[0].S);for(var n=1;n<Fr.length;n++){var t=yr('h3');t.innerText=Fr[n].name,Ar(r,t),(t=yr('p')).style.wordBreak='break-word',t.innerHTML=Fr[n].S,Ar(r,t)}})}function wr(r,n,t){fr[n][r]=t,sr.push([n,r])}function $r(){P(),br=!1,L&&(clearInterval(L),L=!1),i=ar.o,lr=w,fr=U(l,function(){return U(l,X)}),cr=ur=vr=!1,sr=[],er()}function Mr(r){I.innerText=r}function Sr(r,n){Mr(`[${n}, ${r}]`)}function Cr(r,n){return[r=(r=Math.floor(r/h*l))<0?0:l<=r?l-1:r,n=(n=Math.floor(n/h*l))<0?0:l<=n?l-1:n]}function Ir(r,n){cr&&r==cr[1]&&n==cr[0]||(i!=ar.t||br||Sr(r,n),cr=[n,r],K())}function xr(r,n){i==ar.t?0==fr[n][r]||d?(vr=!1,er(r,n)):Mr('该点已经有子'):i==ar.u&&Mr('计算机正在思考')}'function'==typeof t&&t(x,S,F,I),$r(),S.addEventListener('mousemove',function(r){var[n,t]=Cr(r.offsetX,r.offsetY);Ir(n,t),r.preventDefault()}),S.addEventListener('click',function(r){var[n,r]=Cr(r.offsetX,r.offsetY);xr(n,r)});var Dr,Wr,Nr,Jr,Er,Or=0,qr=h*h/(l*l);function Br(r){var n=S.getBoundingClientRect();return[Math.round(r.clientX-n.x),Math.round(r.clientY-n.y)]}function zr(r){switch(r){case or.v:ir();break;case or.reset:$r();break;case or.k:i!=ar.t||br||(f.postMessage([l,fr,1,$]),L=Z(V,1e3),br=!0);break;case or.W:dr=!dr,K();break;case or.info:!function u(){G(function(r,n,t){var a=`${_r[s]}(${s})`;N(r,or.info,'h2'),N(r,`第 ${sr.length} 手`),N(r,`先手: ${lr?'玩家':'电脑'}`),N(r,`难度: ${gr[$]}(${$})`);var e,o=J('<h3>存储</h3>');for(e in(i=yr('h4')).innerHTML=a,i.style.marginTop=i.style.marginBottom=0,Ar(o,i),0!=s&&((a=function(){if(0!=s)return v.getItem(Pr)}())&&''!=a||(a='无存储的数据'),(f=yr('p')).style.maxHeight=T(h/4),f.style.overflowY='auto',f.style.wordBreak='break-word',f.innerText=a,Ar(o,f)),Ar(r,o),o=J('<h3>棋局信息</h3>'),kr){var i,f,c=kr[e];(i=yr('h4')).innerHTML=c.name,i.style.marginTop=i.style.marginBottom=0,Ar(o,i),(f=yr('p')).style.maxHeight=T(h/3),f.style.overflowY='auto',f.style.wordBreak='break-word',f.innerText=c.P(sr),Ar(o,f)}Ar(r,o),n.unshift({name:'清空存储数据',P:function(){0!=s&&v.removeItem(Pr),t(),u()}})})}();break;case or.q:mr()}}S.addEventListener('touchstart',function(r){var n;1==r.touches.length&&([Dr,Wr]=Br(r.touches[0]),Or=0,[n,r]=Cr(Dr,Wr),Ir(n,r),Er=!0)}),S.addEventListener('touchmove',function(r){var n,t,a,e;1==r.touches.length&&Er?([n,t]=Br(r.touches[0]),0==Or?3*qr<=(a=n-Dr)*a+(e=t-Wr)*e&&(Or=1,Nr=Math.round(3*Math.sqrt(20*qr)/5),Jr=Math.round(4*Math.sqrt(20*qr)/5)):(a=n-Nr,e=t-Jr,n<0||t<0||h<=a||h<=e?(cr=!1,K()):([a,e]=Cr(a,e),Ir(a,e))),r.preventDefault()):Er=!1}),S.addEventListener('touchend',function(r){cr&&xr(cr[1],cr[0]),r.preventDefault()}),x.addEventListener('keydown',function(r){if(cr&&!W&&!r.ctrlKey&&!r.altKey&&!r.shiftKey&&!r.metaKey){var n,t,a,e=!0;switch(r.key){case'ArrowLeft':case'a':n=[0,-1];break;case'ArrowRight':case'd':n=[0,1];break;case'ArrowUp':case'w':n=[-1,0];break;case'ArrowDown':case's':n=[1,0];break;case'Enter':case' ':xr(cr[1],cr[0]);break;case'q':ir();break;default:e=!1}n&&([t,a]=cr,t+=n[0],a+=n[1],cr=[t=t<0?0:l<=t?l-1:t,a=a<0?0:l<=a?l-1:a],i!=ar.t||br||Sr(a,t),K()),e&&r.preventDefault()}})}